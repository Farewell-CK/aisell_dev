2025-07-05 15:22:01 - api - INFO - test_logging:20 - API服务日志测试 - 信息级别
2025-07-05 15:22:01 - api - WARNING - test_logging:21 - API服务日志测试 - 警告级别
2025-07-05 15:22:01 - api - ERROR - test_logging:22 - API服务日志测试 - 错误级别
2025-07-05 15:22:01 - summarizer - INFO - test_logging:26 - 文档总结器日志测试 - 信息级别
2025-07-05 15:22:01 - summarizer - WARNING - test_logging:28 - 文档总结器日志测试 - 警告级别
2025-07-05 15:22:01 - database - INFO - test_logging:32 - 数据库操作日志测试 - 信息级别
2025-07-05 15:22:01 - database - ERROR - test_logging:33 - 数据库操作日志测试 - 错误级别
2025-07-05 15:22:01 - utils - INFO - test_logging:37 - 工具模块日志测试 - 信息级别
2025-07-05 15:22:01 - utils - WARNING - test_logging:38 - 工具模块日志测试 - 警告级别
2025-07-05 15:27:13 - api - INFO - <module>:27 - 启动异步文档总结API服务...
2025-07-05 15:27:13 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11431
2025-07-05 15:27:13 - api - INFO - <module>:29 - 自动重载: False
2025-07-05 15:27:13 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11431/docs
2025-07-05 15:27:13 - api - INFO - <module>:31 - API文档(ReDoc): http://0.0.0.0:11431/redoc
2025-07-05 15:31:39 - api - INFO - <module>:27 - 启动异步文档总结API服务...
2025-07-05 15:31:39 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11431
2025-07-05 15:31:39 - api - INFO - <module>:29 - 自动重载: False
2025-07-05 15:31:39 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11431/docs
2025-07-05 15:31:39 - api - INFO - <module>:31 - API文档(ReDoc): http://0.0.0.0:11431/redoc
2025-07-05 15:31:41 - summarizer - INFO - __init__:46 - TextSummarizer 初始化完成。Chunk size: 4000, Overlap size: 200
2025-07-05 15:31:41 - summarizer - INFO - __init__:309 - ImageSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2/, Model: ernie-4.5-turbo-vl-preview
2025-07-05 15:31:41 - summarizer - INFO - __init__:540 - TableSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2
2025-07-05 15:31:41 - summarizer - INFO - __init__:904 - PPTSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2/, Model: ernie-4.5-turbo-128k
2025-07-05 15:31:41 - summarizer - INFO - __init__:905 - 确保 LibreOffice (soffice) 已安装并在系统 PATH 中，以便支持 .ppt 文件转换。
2025-07-05 15:31:41 - summarizer - INFO - __init__:1331 - DocumentSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2/, Model: ernie-4.5-turbo-128k, Chunk Size: 4000, Overlap Size: 200
2025-07-05 15:31:41 - summarizer - WARNING - __init__:1335 - 注意: 当前 summarize_document 方法会将整个提取的文档内容作为单个JSON字符串发送给LLM。即使 ernie-4.5-turbo-128k 支持长上下文，对于超大文档，将结构化JSON直接传入仍需注意实际token消耗和成本。类中定义的 chunk_size, overlap_size 和 split_text 方法目前未用于对提取的文档原始文本内容进行分块总结。如需更精细或成本优化的超长文档处理，请考虑修改 summarize_document 以实现基于原始文本的分块和可能的分层总结策略。
2025-07-05 15:31:41 - summarizer - INFO - __init__:1821 - VideoSummarizer 初始化完成。API base_url: https://dashscope.aliyuncs.com/compatible-mode/v1, Model: qwen-vl-max-latest
2025-07-05 15:31:41 - summarizer - WARNING - __init__:1822 - 当前版本主要支持通过 URL 处理视频。本地视频文件处理功能尚未完全实现。
2025-07-05 15:32:08 - api - INFO - <module>:27 - 启动异步文档总结API服务...
2025-07-05 15:32:08 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11431
2025-07-05 15:32:08 - api - INFO - <module>:29 - 自动重载: False
2025-07-05 15:32:08 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11431/docs
2025-07-05 15:32:08 - api - INFO - <module>:31 - API文档(ReDoc): http://0.0.0.0:11431/redoc
2025-07-05 15:32:09 - summarizer - INFO - __init__:46 - TextSummarizer 初始化完成。Chunk size: 4000, Overlap size: 200
2025-07-05 15:32:09 - summarizer - INFO - __init__:309 - ImageSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2/, Model: ernie-4.5-turbo-vl-preview
2025-07-05 15:32:10 - summarizer - INFO - __init__:540 - TableSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2
2025-07-05 15:32:10 - summarizer - INFO - __init__:904 - PPTSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2/, Model: ernie-4.5-turbo-128k
2025-07-05 15:32:10 - summarizer - INFO - __init__:905 - 确保 LibreOffice (soffice) 已安装并在系统 PATH 中，以便支持 .ppt 文件转换。
2025-07-05 15:32:10 - summarizer - INFO - __init__:1331 - DocumentSummarizer 初始化完成。API base_url: https://qianfan.baidubce.com/v2/, Model: ernie-4.5-turbo-128k, Chunk Size: 4000, Overlap Size: 200
2025-07-05 15:32:10 - summarizer - WARNING - __init__:1335 - 注意: 当前 summarize_document 方法会将整个提取的文档内容作为单个JSON字符串发送给LLM。即使 ernie-4.5-turbo-128k 支持长上下文，对于超大文档，将结构化JSON直接传入仍需注意实际token消耗和成本。类中定义的 chunk_size, overlap_size 和 split_text 方法目前未用于对提取的文档原始文本内容进行分块总结。如需更精细或成本优化的超长文档处理，请考虑修改 summarize_document 以实现基于原始文本的分块和可能的分层总结策略。
2025-07-05 15:32:10 - summarizer - INFO - __init__:1821 - VideoSummarizer 初始化完成。API base_url: https://dashscope.aliyuncs.com/compatible-mode/v1, Model: qwen-vl-max-latest
2025-07-05 15:32:10 - summarizer - WARNING - __init__:1822 - 当前版本主要支持通过 URL 处理视频。本地视频文件处理功能尚未完全实现。
2025-07-05 15:33:02 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=156 的状态为 1
2025-07-05 15:33:02 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp_8b4kuul.jpg
2025-07-05 15:33:02 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp_8b4kuul.jpg
2025-07-05 15:33:02 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp_8b4kuul.jpg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:33:02 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp_8b4kuul.jpg' 的MIME类型为: image/jpeg
2025-07-05 15:33:02 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp_8b4kuul.jpg
2025-07-05 15:33:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:33:07 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 79 字符。
2025-07-05 15:33:07 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=156 的状态为 2
2025-07-05 15:41:05 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=157 的状态为 1
2025-07-05 15:41:05 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmplw9m_4ex.jpeg
2025-07-05 15:41:05 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmplw9m_4ex.jpeg
2025-07-05 15:41:05 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmplw9m_4ex.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:41:05 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmplw9m_4ex.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:41:05 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmplw9m_4ex.jpeg
2025-07-05 15:41:09 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:41:09 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 70 字符。
2025-07-05 15:41:09 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=157 的状态为 2
2025-07-05 15:45:37 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=158 的状态为 1
2025-07-05 15:45:38 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp1_8igrrb.jpeg
2025-07-05 15:45:38 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp1_8igrrb.jpeg
2025-07-05 15:45:38 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp1_8igrrb.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:45:38 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp1_8igrrb.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:45:38 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp1_8igrrb.jpeg
2025-07-05 15:45:41 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:45:41 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 83 字符。
2025-07-05 15:45:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=158 的状态为 2
2025-07-05 15:45:45 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=158 的状态为 1
2025-07-05 15:45:46 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpgkyhmjlg.jpeg
2025-07-05 15:45:46 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpgkyhmjlg.jpeg
2025-07-05 15:45:46 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpgkyhmjlg.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:45:46 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpgkyhmjlg.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:45:46 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpgkyhmjlg.jpeg
2025-07-05 15:45:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:45:48 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 83 字符。
2025-07-05 15:45:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=158 的状态为 2
2025-07-05 15:45:56 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=158 的状态为 1
2025-07-05 15:45:56 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpm07fvfjf.jpeg
2025-07-05 15:45:56 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpm07fvfjf.jpeg
2025-07-05 15:45:56 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpm07fvfjf.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:45:56 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpm07fvfjf.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:45:56 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpm07fvfjf.jpeg
2025-07-05 15:45:59 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:45:59 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 75 字符。
2025-07-05 15:45:59 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=158 的状态为 2
2025-07-05 15:46:10 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 1
2025-07-05 15:46:10 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpwffu3s_f.jpeg
2025-07-05 15:46:10 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpwffu3s_f.jpeg
2025-07-05 15:46:10 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpwffu3s_f.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:46:10 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpwffu3s_f.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:46:10 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpwffu3s_f.jpeg
2025-07-05 15:46:13 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:46:13 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 72 字符。
2025-07-05 15:46:13 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 2
2025-07-05 15:46:15 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 1
2025-07-05 15:46:16 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpo_piedj5.jpeg
2025-07-05 15:46:16 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpo_piedj5.jpeg
2025-07-05 15:46:16 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpo_piedj5.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:46:16 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpo_piedj5.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:46:16 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpo_piedj5.jpeg
2025-07-05 15:46:18 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:46:18 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 76 字符。
2025-07-05 15:46:18 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 2
2025-07-05 15:46:21 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 1
2025-07-05 15:46:22 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp9xrmglm9.jpeg
2025-07-05 15:46:22 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp9xrmglm9.jpeg
2025-07-05 15:46:22 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp9xrmglm9.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:46:22 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp9xrmglm9.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:46:22 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp9xrmglm9.jpeg
2025-07-05 15:46:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:46:24 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 72 字符。
2025-07-05 15:46:24 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 2
2025-07-05 15:46:27 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 1
2025-07-05 15:46:28 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpbr4d7u91.jpeg
2025-07-05 15:46:28 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpbr4d7u91.jpeg
2025-07-05 15:46:28 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpbr4d7u91.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:46:28 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpbr4d7u91.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:46:28 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpbr4d7u91.jpeg
2025-07-05 15:46:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:46:30 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 72 字符。
2025-07-05 15:46:30 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=159 的状态为 2
2025-07-05 15:55:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:55:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:55:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:55:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:55:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:55:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:32 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 15:56:38 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 15:56:43 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:43 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:43 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:43 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:43 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:43 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 15:56:44 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 15:56:47 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 1
2025-07-05 15:56:47 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmp0jqxhh_1.xlsx
2025-07-05 15:56:47 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmp0jqxhh_1.xlsx
2025-07-05 15:56:47 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmp0jqxhh_1.xlsx
2025-07-05 15:56:47 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:56:47 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmp0jqxhh_1.xlsx
2025-07-05 15:56:47 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 15:56:47 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 15:56:47 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:56:47 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 15:56:47 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 15:56:47 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:56:47 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 1
2025-07-05 15:56:47 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp23rdhxyt.jpeg
2025-07-05 15:56:47 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp23rdhxyt.jpeg
2025-07-05 15:56:47 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp23rdhxyt.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:56:47 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp23rdhxyt.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:56:47 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp23rdhxyt.jpeg
2025-07-05 15:56:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:56:48 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpygdcpb8d.docx
2025-07-05 15:56:48 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpygdcpb8d.docx
2025-07-05 15:56:48 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:56:48 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpygdcpb8d.docx
2025-07-05 15:56:48 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:56:48 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:56:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:56:48 - api - INFO - test_role_service_logging:21 - 角色创建API服务日志测试 - 信息级别
2025-07-05 15:56:48 - api - WARNING - test_role_service_logging:22 - 角色创建API服务日志测试 - 警告级别
2025-07-05 15:56:48 - api - ERROR - test_role_service_logging:23 - 角色创建API服务日志测试 - 错误级别
2025-07-05 15:56:48 - utils - INFO - test_role_service_logging:27 - 角色创建工具模块日志测试 - 信息级别
2025-07-05 15:56:48 - utils - WARNING - test_role_service_logging:29 - 角色创建工具模块日志测试 - 警告级别
2025-07-05 15:56:48 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp843u8gv9.jpeg
2025-07-05 15:56:48 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp843u8gv9.jpeg
2025-07-05 15:56:48 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp843u8gv9.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:56:48 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp843u8gv9.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:56:48 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp843u8gv9.jpeg
2025-07-05 15:56:49 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:56:49 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 107
2025-07-05 15:56:49 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-05 15:56:50 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:56:50 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:56:50 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 70 字符。
2025-07-05 15:56:50 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-05 15:56:50 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpe5y7cxnk.xlsx
2025-07-05 15:56:50 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpe5y7cxnk.xlsx
2025-07-05 15:56:50 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpe5y7cxnk.xlsx
2025-07-05 15:56:50 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:56:50 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpe5y7cxnk.xlsx
2025-07-05 15:56:50 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:56:50 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:56:50 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:56:50 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:56:50 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:56:50 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:56:50 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:56:50 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:56:50 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:56:51 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 15:56:51 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpr77x38hn.doc
2025-07-05 15:56:51 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmpr77x38hn.doc)
2025-07-05 15:56:51 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 15:56:52 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:56:52 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 70 字符。
2025-07-05 15:56:52 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:56:54 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:56:54 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 160
2025-07-05 15:56:54 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:56:54 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:56:54 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp9rdz0i0d.jpeg
2025-07-05 15:56:54 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp9rdz0i0d.jpeg
2025-07-05 15:56:54 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp9rdz0i0d.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:56:54 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp9rdz0i0d.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:56:54 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp9rdz0i0d.jpeg
2025-07-05 15:56:56 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:56:56 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpu3zv7ccf.xlsx
2025-07-05 15:56:56 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpu3zv7ccf.xlsx
2025-07-05 15:56:56 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpu3zv7ccf.xlsx
2025-07-05 15:56:56 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:56:56 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpu3zv7ccf.xlsx
2025-07-05 15:56:56 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:56:56 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:56:56 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:56:56 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:56:56 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:56:56 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:56:56 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:56:56 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:56:56 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:56:58 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:56:58 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 83 字符。
2025-07-05 15:56:58 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:00 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:00 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp69b75w0j.jpeg
2025-07-05 15:57:00 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp69b75w0j.jpeg
2025-07-05 15:57:00 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp69b75w0j.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:00 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp69b75w0j.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:00 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp69b75w0j.jpeg
2025-07-05 15:57:00 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:00 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 159
2025-07-05 15:57:00 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:02 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:02 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 84 字符。
2025-07-05 15:57:02 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:03 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:03 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpx8od2k08.xlsx
2025-07-05 15:57:03 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpx8od2k08.xlsx
2025-07-05 15:57:03 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpx8od2k08.xlsx
2025-07-05 15:57:03 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:03 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpx8od2k08.xlsx
2025-07-05 15:57:03 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:03 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:03 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:03 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:03 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:03 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:03 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:03 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:03 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:05 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:05 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp1ppc__4r.jpeg
2025-07-05 15:57:05 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp1ppc__4r.jpeg
2025-07-05 15:57:05 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp1ppc__4r.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:05 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp1ppc__4r.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:05 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp1ppc__4r.jpeg
2025-07-05 15:57:06 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:06 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 131
2025-07-05 15:57:06 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:07 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:08 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmp0yceaakv.xlsx
2025-07-05 15:57:08 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmp0yceaakv.xlsx
2025-07-05 15:57:08 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmp0yceaakv.xlsx
2025-07-05 15:57:08 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:08 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmp0yceaakv.xlsx
2025-07-05 15:57:08 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:08 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:08 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:08 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:08 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:08 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:08 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:08 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:08 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:08 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:08 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 83 字符。
2025-07-05 15:57:08 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:09 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:09 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1575
2025-07-05 15:57:09 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:57:10 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:10 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 132
2025-07-05 15:57:10 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:11 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:11 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:57:12 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp0jemnyh5.docx
2025-07-05 15:57:12 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp0jemnyh5.docx
2025-07-05 15:57:12 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp9_vfv9id.jpeg
2025-07-05 15:57:12 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp9_vfv9id.jpeg
2025-07-05 15:57:12 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp9_vfv9id.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:12 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp9_vfv9id.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:12 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp9_vfv9id.jpeg
2025-07-05 15:57:12 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:57:12 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp0jemnyh5.docx
2025-07-05 15:57:12 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:57:12 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:57:13 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:13 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmp5nyj7b61.xlsx
2025-07-05 15:57:13 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmp5nyj7b61.xlsx
2025-07-05 15:57:13 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmp5nyj7b61.xlsx
2025-07-05 15:57:13 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:13 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmp5nyj7b61.xlsx
2025-07-05 15:57:13 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:13 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:13 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:13 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:13 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:13 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:13 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:13 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:13 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:14 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:14 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 69 字符。
2025-07-05 15:57:14 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:16 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpp0u1rxqw.jpeg
2025-07-05 15:57:16 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpp0u1rxqw.jpeg
2025-07-05 15:57:16 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpp0u1rxqw.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:16 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpp0u1rxqw.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:16 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpp0u1rxqw.jpeg
2025-07-05 15:57:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:17 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 175
2025-07-05 15:57:17 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:19 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:19 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 78 字符。
2025-07-05 15:57:19 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:19 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:19 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpb1_jl1st.xlsx
2025-07-05 15:57:19 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpb1_jl1st.xlsx
2025-07-05 15:57:19 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpb1_jl1st.xlsx
2025-07-05 15:57:19 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:19 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpb1_jl1st.xlsx
2025-07-05 15:57:19 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:19 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:19 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:19 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:19 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:19 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:19 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:19 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:19 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:21 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:21 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmphrii5g7r.jpeg
2025-07-05 15:57:21 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmphrii5g7r.jpeg
2025-07-05 15:57:21 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmphrii5g7r.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:21 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmphrii5g7r.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:21 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmphrii5g7r.jpeg
2025-07-05 15:57:22 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:22 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 111
2025-07-05 15:57:22 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:24 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 79 字符。
2025-07-05 15:57:24 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:25 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:25 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpj2z95x45.xlsx
2025-07-05 15:57:25 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpj2z95x45.xlsx
2025-07-05 15:57:25 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpj2z95x45.xlsx
2025-07-05 15:57:25 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:25 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpj2z95x45.xlsx
2025-07-05 15:57:25 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:25 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:25 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:25 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:25 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:25 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:25 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:25 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:25 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:27 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:27 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp5jo4i3m6.jpeg
2025-07-05 15:57:27 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp5jo4i3m6.jpeg
2025-07-05 15:57:27 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp5jo4i3m6.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:27 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp5jo4i3m6.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:27 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp5jo4i3m6.jpeg
2025-07-05 15:57:28 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:28 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 138
2025-07-05 15:57:29 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:30 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 71 字符。
2025-07-05 15:57:30 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:32 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:32 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmp5em4nutb.xlsx
2025-07-05 15:57:32 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmp5em4nutb.xlsx
2025-07-05 15:57:32 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmp5em4nutb.xlsx
2025-07-05 15:57:32 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:32 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmp5em4nutb.xlsx
2025-07-05 15:57:32 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:32 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:32 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:32 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:32 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:32 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:32 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:32 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:32 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:32 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:33 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1602
2025-07-05 15:57:33 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:57:33 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:33 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp5iftoezr.jpeg
2025-07-05 15:57:33 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp5iftoezr.jpeg
2025-07-05 15:57:33 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp5iftoezr.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:33 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp5iftoezr.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:33 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp5iftoezr.jpeg
2025-07-05 15:57:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:57:35 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:35 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 160
2025-07-05 15:57:35 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpmrx9i83q.docx
2025-07-05 15:57:35 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpmrx9i83q.docx
2025-07-05 15:57:35 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:57:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:35 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpmrx9i83q.docx
2025-07-05 15:57:35 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:57:35 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:57:37 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:37 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 78 字符。
2025-07-05 15:57:37 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:37 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=166 的状态为 1
2025-07-05 15:57:37 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:37 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpambixtx6.xlsx
2025-07-05 15:57:37 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpambixtx6.xlsx
2025-07-05 15:57:37 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpambixtx6.xlsx
2025-07-05 15:57:37 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:37 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpambixtx6.xlsx
2025-07-05 15:57:37 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:37 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:37 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:37 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:37 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:37 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:37 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:37 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:37 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:38 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpiclrm30p.pdf
2025-07-05 15:57:38 - summarizer - INFO - extract_pdf_content:1373 - 开始提取PDF内容: /tmp/tmpiclrm30p.pdf
2025-07-05 15:57:38 - summarizer - INFO - extract_pdf_content:1401 - PDF共有 104 页。
2025-07-05 15:57:39 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:39 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp0p94ns3b.jpeg
2025-07-05 15:57:39 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp0p94ns3b.jpeg
2025-07-05 15:57:39 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp0p94ns3b.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:39 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp0p94ns3b.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:39 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp0p94ns3b.jpeg
2025-07-05 15:57:41 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:41 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 127
2025-07-05 15:57:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:42 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:42 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 92 字符。
2025-07-05 15:57:42 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:43 - summarizer - INFO - extract_pdf_content:1429 - PDF内容提取完成: /tmp/tmpiclrm30p.pdf
2025-07-05 15:57:43 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 54417
2025-07-05 15:57:43 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:57:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=167 的状态为 1
2025-07-05 15:57:43 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpu9hk9eos.pdf
2025-07-05 15:57:43 - summarizer - INFO - extract_pdf_content:1373 - 开始提取PDF内容: /tmp/tmpu9hk9eos.pdf
2025-07-05 15:57:43 - summarizer - INFO - extract_pdf_content:1401 - PDF共有 16 页。
2025-07-05 15:57:44 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:44 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpldpn4m8a.xlsx
2025-07-05 15:57:44 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpldpn4m8a.xlsx
2025-07-05 15:57:44 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpldpn4m8a.xlsx
2025-07-05 15:57:44 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:44 - summarizer - INFO - extract_pdf_content:1429 - PDF内容提取完成: /tmp/tmpu9hk9eos.pdf
2025-07-05 15:57:44 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpldpn4m8a.xlsx
2025-07-05 15:57:44 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3831
2025-07-05 15:57:44 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:44 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:57:44 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:44 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:44 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:44 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:44 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:44 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:44 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:44 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:44 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:44 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 43
2025-07-05 15:57:44 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=167 的状态为 2
2025-07-05 15:57:45 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:45 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpefp6bji3.jpeg
2025-07-05 15:57:45 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpefp6bji3.jpeg
2025-07-05 15:57:45 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpefp6bji3.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:45 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpefp6bji3.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:45 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpefp6bji3.jpeg
2025-07-05 15:57:47 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=167 的状态为 1
2025-07-05 15:57:47 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpqv9nfu1x.pdf
2025-07-05 15:57:47 - summarizer - INFO - extract_pdf_content:1373 - 开始提取PDF内容: /tmp/tmpqv9nfu1x.pdf
2025-07-05 15:57:47 - summarizer - INFO - extract_pdf_content:1401 - PDF共有 16 页。
2025-07-05 15:57:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:48 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 145
2025-07-05 15:57:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:48 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 83 字符。
2025-07-05 15:57:48 - summarizer - INFO - extract_pdf_content:1429 - PDF内容提取完成: /tmp/tmpqv9nfu1x.pdf
2025-07-05 15:57:48 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3831
2025-07-05 15:57:48 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:57:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:48 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 43
2025-07-05 15:57:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=167 的状态为 2
2025-07-05 15:57:51 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:51 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:51 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpcdqhhlr8.jpeg
2025-07-05 15:57:51 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpcdqhhlr8.jpeg
2025-07-05 15:57:51 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpcdqhhlr8.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:51 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpcdqhhlr8.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:51 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpcdqhhlr8.jpeg
2025-07-05 15:57:51 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpsvhuyc6c.xlsx
2025-07-05 15:57:51 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpsvhuyc6c.xlsx
2025-07-05 15:57:51 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpsvhuyc6c.xlsx
2025-07-05 15:57:51 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:51 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpsvhuyc6c.xlsx
2025-07-05 15:57:51 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:51 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:51 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:51 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:51 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:51 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:51 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:51 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:51 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:54 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:54 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 70 字符。
2025-07-05 15:57:54 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:57:55 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:55 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1449
2025-07-05 15:57:55 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:57:55 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:57:55 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 111
2025-07-05 15:57:55 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:57:57 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:57:57 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 1
2025-07-05 15:57:57 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-05 15:57:57 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp_h9l4lye.docx
2025-07-05 15:57:57 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp_h9l4lye.docx
2025-07-05 15:57:57 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:57:57 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpoh5aipqv.xlsx
2025-07-05 15:57:57 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpoh5aipqv.xlsx
2025-07-05 15:57:57 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpoh5aipqv.xlsx
2025-07-05 15:57:57 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 15:57:57 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpoh5aipqv.xlsx
2025-07-05 15:57:57 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 5, 列数: 10
2025-07-05 15:57:57 - summarizer - INFO - get_table_info:660 - 找到数值列: ['描述', '产品图片', '购买链接', '最低起售量', '标准售价', '最低售价']
2025-07-05 15:57:57 - summarizer - WARNING - get_table_info:663 - 数值列 '描述' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:57 - summarizer - WARNING - get_table_info:663 - 数值列 '产品图片' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:57 - summarizer - WARNING - get_table_info:663 - 数值列 '购买链接' 完全为空，统计值将为 NaN 或引发错误。
2025-07-05 15:57:57 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 15:57:57 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 1362
2025-07-05 15:57:57 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 383
2025-07-05 15:57:57 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 15:57:57 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp_h9l4lye.docx
2025-07-05 15:57:57 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:57:57 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:57:57 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpmsk3nc_t.jpeg
2025-07-05 15:57:57 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpmsk3nc_t.jpeg
2025-07-05 15:57:57 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpmsk3nc_t.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 15:57:57 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpmsk3nc_t.jpeg' 的MIME类型为: image/jpeg
2025-07-05 15:57:57 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpmsk3nc_t.jpeg
2025-07-05 15:58:00 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:00 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 69 字符。
2025-07-05 15:58:00 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-05 15:58:02 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:02 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 141
2025-07-05 15:58:02 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=164 的状态为 2
2025-07-05 15:58:08 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 1
2025-07-05 15:58:08 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:09 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1504
2025-07-05 15:58:09 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=166 的状态为 2
2025-07-05 15:58:09 - summarizer - INFO - summarize_ppt:1107 - 开始总结PPT: /tmp/tmpdkcn1wmx.pptx
2025-07-05 15:58:09 - summarizer - INFO - extract_ppt_content:975 - 开始提取文件内容: /tmp/tmpdkcn1wmx.pptx
2025-07-05 15:58:09 - summarizer - INFO - extract_ppt_content:1031 - 输入为本地文件路径: /tmp/tmpdkcn1wmx.pptx
2025-07-05 15:58:09 - summarizer - INFO - extract_ppt_content:1051 - 正在使用 python-pptx 解析: /tmp/tmpdkcn1wmx.pptx
2025-07-05 15:58:09 - summarizer - INFO - extract_ppt_content:1054 - 文件共有 20 张幻灯片。
2025-07-05 15:58:09 - summarizer - INFO - extract_ppt_content:1076 - 内容提取完成: /tmp/tmpdkcn1wmx.pptx
2025-07-05 15:58:09 - summarizer - INFO - summarize_ppt:1117 - 提取的PPT内容字符串长度: 1626
2025-07-05 15:58:09 - summarizer - INFO - summarize_ppt:1148 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行PPT总结...
2025-07-05 15:58:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:21 - summarizer - INFO - summarize_ppt:1159 - LLM PPT总结接收成功，长度: 700
2025-07-05 15:58:21 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 2
2025-07-05 15:58:23 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 1
2025-07-05 15:58:24 - summarizer - INFO - summarize_ppt:1107 - 开始总结PPT: /tmp/tmpczru03yg.pptx
2025-07-05 15:58:24 - summarizer - INFO - extract_ppt_content:975 - 开始提取文件内容: /tmp/tmpczru03yg.pptx
2025-07-05 15:58:24 - summarizer - INFO - extract_ppt_content:1031 - 输入为本地文件路径: /tmp/tmpczru03yg.pptx
2025-07-05 15:58:24 - summarizer - INFO - extract_ppt_content:1051 - 正在使用 python-pptx 解析: /tmp/tmpczru03yg.pptx
2025-07-05 15:58:24 - summarizer - INFO - extract_ppt_content:1054 - 文件共有 20 张幻灯片。
2025-07-05 15:58:24 - summarizer - INFO - extract_ppt_content:1076 - 内容提取完成: /tmp/tmpczru03yg.pptx
2025-07-05 15:58:24 - summarizer - INFO - summarize_ppt:1117 - 提取的PPT内容字符串长度: 1626
2025-07-05 15:58:24 - summarizer - INFO - summarize_ppt:1148 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行PPT总结...
2025-07-05 15:58:29 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:29 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1606
2025-07-05 15:58:29 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:58:33 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:33 - summarizer - INFO - summarize_ppt:1159 - LLM PPT总结接收成功，长度: 684
2025-07-05 15:58:33 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 2
2025-07-05 15:58:34 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:58:34 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpmuq4rjj3.docx
2025-07-05 15:58:34 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpmuq4rjj3.docx
2025-07-05 15:58:34 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:58:34 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpmuq4rjj3.docx
2025-07-05 15:58:34 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:58:34 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:58:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 1
2025-07-05 15:58:44 - summarizer - INFO - summarize_ppt:1107 - 开始总结PPT: /tmp/tmp7di3m1io.pptx
2025-07-05 15:58:44 - summarizer - INFO - extract_ppt_content:975 - 开始提取文件内容: /tmp/tmp7di3m1io.pptx
2025-07-05 15:58:44 - summarizer - INFO - extract_ppt_content:1031 - 输入为本地文件路径: /tmp/tmp7di3m1io.pptx
2025-07-05 15:58:44 - summarizer - INFO - extract_ppt_content:1051 - 正在使用 python-pptx 解析: /tmp/tmp7di3m1io.pptx
2025-07-05 15:58:44 - summarizer - INFO - extract_ppt_content:1054 - 文件共有 20 张幻灯片。
2025-07-05 15:58:44 - summarizer - INFO - extract_ppt_content:1076 - 内容提取完成: /tmp/tmp7di3m1io.pptx
2025-07-05 15:58:44 - summarizer - INFO - summarize_ppt:1117 - 提取的PPT内容字符串长度: 1626
2025-07-05 15:58:44 - summarizer - INFO - summarize_ppt:1148 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行PPT总结...
2025-07-05 15:58:51 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:51 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1236
2025-07-05 15:58:51 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:58:53 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:58:53 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp5haad_yy.docx
2025-07-05 15:58:53 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp5haad_yy.docx
2025-07-05 15:58:53 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:58:53 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp5haad_yy.docx
2025-07-05 15:58:53 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:58:53 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:58:56 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:58:56 - summarizer - INFO - summarize_ppt:1159 - LLM PPT总结接收成功，长度: 696
2025-07-05 15:58:56 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 2
2025-07-05 15:59:03 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 1
2025-07-05 15:59:04 - summarizer - INFO - summarize_ppt:1107 - 开始总结PPT: /tmp/tmpyai5c_qu.pptx
2025-07-05 15:59:04 - summarizer - INFO - extract_ppt_content:975 - 开始提取文件内容: /tmp/tmpyai5c_qu.pptx
2025-07-05 15:59:04 - summarizer - INFO - extract_ppt_content:1031 - 输入为本地文件路径: /tmp/tmpyai5c_qu.pptx
2025-07-05 15:59:04 - summarizer - INFO - extract_ppt_content:1051 - 正在使用 python-pptx 解析: /tmp/tmpyai5c_qu.pptx
2025-07-05 15:59:04 - summarizer - INFO - extract_ppt_content:1054 - 文件共有 20 张幻灯片。
2025-07-05 15:59:04 - summarizer - INFO - extract_ppt_content:1076 - 内容提取完成: /tmp/tmpyai5c_qu.pptx
2025-07-05 15:59:04 - summarizer - INFO - summarize_ppt:1117 - 提取的PPT内容字符串长度: 1626
2025-07-05 15:59:04 - summarizer - INFO - summarize_ppt:1148 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行PPT总结...
2025-07-05 15:59:07 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=169 的状态为 1
2025-07-05 15:59:07 - summarizer - INFO - summarize_video:1862 - 开始处理单个视频总结: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 15:59:07 - summarizer - INFO - summarize_video:1867 - 输入源为有效URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 15:59:07 - summarizer - INFO - summarize_video:1899 - 向模型 'qwen-vl-max-latest' 发送视频总结请求，视频URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 15:59:09 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-05 15:59:09 - summarizer - ERROR - summarize_video:1924 - 使用模型分析视频 'https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4' 时出错: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-119aee78-3074-9a72-b664-cbdd1549dfe2', 'request_id': '119aee78-3074-9a72-b664-cbdd1549dfe2'}
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/file_description.py", line 1914, in summarize_video
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 925, in create
    return self._post(
           ^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-119aee78-3074-9a72-b664-cbdd1549dfe2', 'request_id': '119aee78-3074-9a72-b664-cbdd1549dfe2'}
2025-07-05 15:59:09 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=169 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-119aee78-3074-9a72-b664-cbdd1549dfe2', 'request_id': '119aee78-3074-9a72-b664-cbdd1549dfe2'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-119aee78-3074-9a72-b664-cbdd1549dfe2', 'request_id': '119aee78-3074-9a72-b664-cbdd1549dfe2'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-119aee78-3074-9a72-b664-cbdd1549dfe2', 'request_id': '119aee78-3074-9a72-b664-cbdd1549dfe2'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 15:59:18 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:59:18 - summarizer - INFO - summarize_ppt:1159 - LLM PPT总结接收成功，长度: 735
2025-07-05 15:59:18 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 2
2025-07-05 15:59:18 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:59:18 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1444
2025-07-05 15:59:18 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:59:23 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:59:23 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 1
2025-07-05 15:59:24 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp1zwlb_4y.docx
2025-07-05 15:59:24 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp1zwlb_4y.docx
2025-07-05 15:59:24 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:59:24 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp1zwlb_4y.docx
2025-07-05 15:59:24 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:59:24 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:59:24 - summarizer - INFO - summarize_ppt:1107 - 开始总结PPT: /tmp/tmp70ofubtz.pptx
2025-07-05 15:59:24 - summarizer - INFO - extract_ppt_content:975 - 开始提取文件内容: /tmp/tmp70ofubtz.pptx
2025-07-05 15:59:24 - summarizer - INFO - extract_ppt_content:1031 - 输入为本地文件路径: /tmp/tmp70ofubtz.pptx
2025-07-05 15:59:24 - summarizer - INFO - extract_ppt_content:1051 - 正在使用 python-pptx 解析: /tmp/tmp70ofubtz.pptx
2025-07-05 15:59:24 - summarizer - INFO - extract_ppt_content:1054 - 文件共有 20 张幻灯片。
2025-07-05 15:59:24 - summarizer - INFO - extract_ppt_content:1076 - 内容提取完成: /tmp/tmp70ofubtz.pptx
2025-07-05 15:59:24 - summarizer - INFO - summarize_ppt:1117 - 提取的PPT内容字符串长度: 1626
2025-07-05 15:59:24 - summarizer - INFO - summarize_ppt:1148 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行PPT总结...
2025-07-05 15:59:35 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:59:35 - summarizer - INFO - summarize_ppt:1159 - LLM PPT总结接收成功，长度: 700
2025-07-05 15:59:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 2
2025-07-05 15:59:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 1
2025-07-05 15:59:44 - summarizer - INFO - summarize_ppt:1107 - 开始总结PPT: /tmp/tmpw7ia0t86.pptx
2025-07-05 15:59:44 - summarizer - INFO - extract_ppt_content:975 - 开始提取文件内容: /tmp/tmpw7ia0t86.pptx
2025-07-05 15:59:44 - summarizer - INFO - extract_ppt_content:1031 - 输入为本地文件路径: /tmp/tmpw7ia0t86.pptx
2025-07-05 15:59:44 - summarizer - INFO - extract_ppt_content:1051 - 正在使用 python-pptx 解析: /tmp/tmpw7ia0t86.pptx
2025-07-05 15:59:44 - summarizer - INFO - extract_ppt_content:1054 - 文件共有 20 张幻灯片。
2025-07-05 15:59:44 - summarizer - INFO - extract_ppt_content:1076 - 内容提取完成: /tmp/tmpw7ia0t86.pptx
2025-07-05 15:59:44 - summarizer - INFO - summarize_ppt:1117 - 提取的PPT内容字符串长度: 1626
2025-07-05 15:59:44 - summarizer - INFO - summarize_ppt:1148 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行PPT总结...
2025-07-05 15:59:45 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:59:45 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1444
2025-07-05 15:59:45 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 15:59:53 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 15:59:53 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmphmt8k2fn.docx
2025-07-05 15:59:53 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmphmt8k2fn.docx
2025-07-05 15:59:53 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 15:59:53 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmphmt8k2fn.docx
2025-07-05 15:59:53 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 15:59:53 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 15:59:57 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 15:59:57 - summarizer - INFO - summarize_ppt:1159 - LLM PPT总结接收成功，长度: 782
2025-07-05 15:59:57 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=168 的状态为 2
2025-07-05 16:00:16 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:00:16 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1635
2025-07-05 16:00:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 16:08:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=169 的状态为 1
2025-07-05 16:08:41 - summarizer - INFO - summarize_video:1862 - 开始处理单个视频总结: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 16:08:41 - summarizer - INFO - summarize_video:1867 - 输入源为有效URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 16:08:41 - summarizer - INFO - summarize_video:1899 - 向模型 'qwen-vl-max-latest' 发送视频总结请求，视频URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 16:08:42 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-05 16:08:42 - summarizer - ERROR - summarize_video:1924 - 使用模型分析视频 'https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4' 时出错: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-3ed4e11d-8615-900d-96a2-afba2e0fd5c6', 'request_id': '3ed4e11d-8615-900d-96a2-afba2e0fd5c6'}
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/file_description.py", line 1914, in summarize_video
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 925, in create
    return self._post(
           ^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-3ed4e11d-8615-900d-96a2-afba2e0fd5c6', 'request_id': '3ed4e11d-8615-900d-96a2-afba2e0fd5c6'}
2025-07-05 16:08:42 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=169 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-3ed4e11d-8615-900d-96a2-afba2e0fd5c6', 'request_id': '3ed4e11d-8615-900d-96a2-afba2e0fd5c6'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-3ed4e11d-8615-900d-96a2-afba2e0fd5c6', 'request_id': '3ed4e11d-8615-900d-96a2-afba2e0fd5c6'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-3ed4e11d-8615-900d-96a2-afba2e0fd5c6', 'request_id': '3ed4e11d-8615-900d-96a2-afba2e0fd5c6'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:13:45 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 16:13:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:13:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:13:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:13:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:13:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:13:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:13:50 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 16:17:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=169 的状态为 1
2025-07-05 16:17:41 - summarizer - INFO - summarize_video:1862 - 开始处理单个视频总结: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 16:17:41 - summarizer - INFO - summarize_video:1867 - 输入源为有效URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 16:17:41 - summarizer - INFO - summarize_video:1899 - 向模型 'qwen-vl-max-latest' 发送视频总结请求，视频URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4
2025-07-05 16:17:42 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-05 16:17:42 - summarizer - ERROR - summarize_video:1924 - 使用模型分析视频 'https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/73a39d86dd8f432993d2e3aa029bbf56.mp4' 时出错: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d07f3b99-5acd-9c3c-8c0f-7f2fa904479c', 'request_id': 'd07f3b99-5acd-9c3c-8c0f-7f2fa904479c'}
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/file_description.py", line 1914, in summarize_video
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 925, in create
    return self._post(
           ^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d07f3b99-5acd-9c3c-8c0f-7f2fa904479c', 'request_id': 'd07f3b99-5acd-9c3c-8c0f-7f2fa904479c'}
2025-07-05 16:17:42 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=169 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d07f3b99-5acd-9c3c-8c0f-7f2fa904479c', 'request_id': 'd07f3b99-5acd-9c3c-8c0f-7f2fa904479c'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d07f3b99-5acd-9c3c-8c0f-7f2fa904479c', 'request_id': 'd07f3b99-5acd-9c3c-8c0f-7f2fa904479c'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d07f3b99-5acd-9c3c-8c0f-7f2fa904479c', 'request_id': 'd07f3b99-5acd-9c3c-8c0f-7f2fa904479c'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 169
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:18:39 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=170 的状态为 1
2025-07-05 16:18:40 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=171 的状态为 1
2025-07-05 16:18:40 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 1
2025-07-05 16:18:40 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmprybba6d3.xlsx
2025-07-05 16:18:40 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmprybba6d3.xlsx
2025-07-05 16:18:40 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmprybba6d3.xlsx
2025-07-05 16:18:40 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:18:40 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmprybba6d3.xlsx
2025-07-05 16:18:40 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:18:40 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:18:40 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:18:40 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:18:40 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:18:40 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:18:40 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpem7yf9_h.jpeg
2025-07-05 16:18:40 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpem7yf9_h.jpeg
2025-07-05 16:18:40 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpem7yf9_h.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 16:18:40 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpem7yf9_h.jpeg' 的MIME类型为: image/jpeg
2025-07-05 16:18:40 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpem7yf9_h.jpeg
2025-07-05 16:18:40 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp4vr6qn2h.jpeg
2025-07-05 16:18:40 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp4vr6qn2h.jpeg
2025-07-05 16:18:40 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp4vr6qn2h.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-05 16:18:40 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp4vr6qn2h.jpeg' 的MIME类型为: image/jpeg
2025-07-05 16:18:40 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp4vr6qn2h.jpeg
2025-07-05 16:18:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:18:43 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 113
2025-07-05 16:18:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:18:43 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 71 字符。
2025-07-05 16:18:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=170 的状态为 2
2025-07-05 16:18:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=171 的状态为 2
2025-07-05 16:18:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:18:43 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 74 字符。
2025-07-05 16:18:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 2
2025-07-05 16:19:06 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 16:19:06 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp3_4lmcd1.doc
2025-07-05 16:19:06 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmp3_4lmcd1.doc)
2025-07-05 16:19:06 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:19:07 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 16:19:07 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpolak_lj0.doc
2025-07-05 16:19:07 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmpolak_lj0.doc)
2025-07-05 16:19:07 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:19:12 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 16:19:12 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpvg9rzw09.doc
2025-07-05 16:19:12 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmpvg9rzw09.doc)
2025-07-05 16:19:13 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:19:13 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 16:19:13 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpymwmytc7.doc
2025-07-05 16:19:13 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmpymwmytc7.doc)
2025-07-05 16:19:13 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:19:14 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 16:19:14 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp10rw9ecv.doc
2025-07-05 16:19:14 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmp10rw9ecv.doc)
2025-07-05 16:19:14 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:19:27 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=165 的状态为 1
2025-07-05 16:19:28 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp2nztowml.doc
2025-07-05 16:19:28 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmp2nztowml.doc)
2025-07-05 16:19:28 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=165 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 165\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 165
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:20:24 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 1
2025-07-05 16:20:24 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpb0ecklf0.xlsx
2025-07-05 16:20:24 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpb0ecklf0.xlsx
2025-07-05 16:20:24 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpb0ecklf0.xlsx
2025-07-05 16:20:24 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:20:24 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpb0ecklf0.xlsx
2025-07-05 16:20:24 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:20:24 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:20:24 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:20:24 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:20:24 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:20:24 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:20:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:20:27 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 101
2025-07-05 16:20:27 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-05 16:21:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=173 的状态为 1
2025-07-05 16:21:42 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpelyy0hnu.doc
2025-07-05 16:21:42 - summarizer - WARNING - summarize_document:1599 - 不支持的文件格式或无法从URL推断格式: '.doc' (源: /tmp/tmpelyy0hnu.doc)
2025-07-05 16:21:42 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=173 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 173\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 173
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 173\n     ' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 173\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 173
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.doc'',\n        update_time = CURRENT_TIMESTAMP\n    WHERE\n        id = 173\n     ' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '不支持的文件格式或无法从URL推断格式: '.doc'',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 173
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:21:45 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 16:21:45 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp07jqrxwd.docx
2025-07-05 16:21:45 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp07jqrxwd.docx
2025-07-05 16:21:45 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 16:21:45 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp07jqrxwd.docx
2025-07-05 16:21:45 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 16:21:45 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 16:21:48 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=170 的状态为 1
2025-07-05 16:21:49 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpfz4hxpr2.xlsx
2025-07-05 16:21:49 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpfz4hxpr2.xlsx
2025-07-05 16:21:49 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpfz4hxpr2.xlsx
2025-07-05 16:21:49 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:21:49 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpfz4hxpr2.xlsx
2025-07-05 16:21:49 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:21:49 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:21:49 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:21:49 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:21:49 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:21:49 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:21:51 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:21:51 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 101
2025-07-05 16:21:51 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=170 的状态为 2
2025-07-05 16:22:04 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:22:04 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1203
2025-07-05 16:22:04 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 16:22:27 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=170 的状态为 1
2025-07-05 16:22:27 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmplkrjvb93.xlsx
2025-07-05 16:22:27 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmplkrjvb93.xlsx
2025-07-05 16:22:27 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmplkrjvb93.xlsx
2025-07-05 16:22:27 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:22:27 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmplkrjvb93.xlsx
2025-07-05 16:22:27 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:22:27 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:22:27 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:22:27 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:22:27 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:22:27 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:22:29 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:22:29 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 94
2025-07-05 16:22:29 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=170 的状态为 2
2025-07-05 16:22:33 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 1
2025-07-05 16:22:33 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpy7akc4qi.xlsx
2025-07-05 16:22:33 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpy7akc4qi.xlsx
2025-07-05 16:22:33 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpy7akc4qi.xlsx
2025-07-05 16:22:33 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:22:33 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpy7akc4qi.xlsx
2025-07-05 16:22:33 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:22:33 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:22:33 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:22:33 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:22:33 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:22:33 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:22:35 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:22:35 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 97
2025-07-05 16:22:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-05 16:22:37 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 1
2025-07-05 16:22:37 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpvyikmhvj.xlsx
2025-07-05 16:22:37 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpvyikmhvj.xlsx
2025-07-05 16:22:37 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpvyikmhvj.xlsx
2025-07-05 16:22:37 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:22:37 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpvyikmhvj.xlsx
2025-07-05 16:22:37 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:22:37 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:22:37 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:22:37 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:22:37 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:22:37 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:22:39 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:22:39 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 113
2025-07-05 16:22:39 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-05 16:22:53 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 16:22:53 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp2jmnngwi.docx
2025-07-05 16:22:53 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp2jmnngwi.docx
2025-07-05 16:22:53 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 16:22:53 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp2jmnngwi.docx
2025-07-05 16:22:53 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 16:22:53 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 16:22:56 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 16:22:56 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpizwwcmd0.docx
2025-07-05 16:22:56 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpizwwcmd0.docx
2025-07-05 16:22:56 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 16:22:56 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpizwwcmd0.docx
2025-07-05 16:22:56 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 16:22:56 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 16:22:59 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-05 16:22:59 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpf_k8cq4g.docx
2025-07-05 16:22:59 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpf_k8cq4g.docx
2025-07-05 16:22:59 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-05 16:22:59 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpf_k8cq4g.docx
2025-07-05 16:22:59 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-05 16:22:59 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 16:23:11 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=167 的状态为 1
2025-07-05 16:23:11 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpz4hqm5lg.pdf
2025-07-05 16:23:11 - summarizer - INFO - extract_pdf_content:1373 - 开始提取PDF内容: /tmp/tmpz4hqm5lg.pdf
2025-07-05 16:23:11 - summarizer - INFO - extract_pdf_content:1401 - PDF共有 16 页。
2025-07-05 16:23:12 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:23:12 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1089
2025-07-05 16:23:12 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 16:23:12 - summarizer - INFO - extract_pdf_content:1429 - PDF内容提取完成: /tmp/tmpz4hqm5lg.pdf
2025-07-05 16:23:12 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3831
2025-07-05 16:23:12 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-05 16:23:12 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:23:12 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 43
2025-07-05 16:23:12 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=167 的状态为 2
2025-07-05 16:23:17 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 1
2025-07-05 16:23:17 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpswr6g5z2.xlsx
2025-07-05 16:23:17 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpswr6g5z2.xlsx
2025-07-05 16:23:17 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpswr6g5z2.xlsx
2025-07-05 16:23:17 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:23:17 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpswr6g5z2.xlsx
2025-07-05 16:23:17 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:23:17 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:23:17 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:23:17 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:23:17 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:23:17 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:23:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:23:17 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1167
2025-07-05 16:23:17 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 16:23:18 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:23:18 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1729
2025-07-05 16:23:18 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-05 16:23:18 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 1
2025-07-05 16:23:19 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpibyxrbdg.xlsx
2025-07-05 16:23:19 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpibyxrbdg.xlsx
2025-07-05 16:23:19 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpibyxrbdg.xlsx
2025-07-05 16:23:19 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-05 16:23:19 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpibyxrbdg.xlsx
2025-07-05 16:23:19 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-05 16:23:19 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-05 16:23:19 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-05 16:23:19 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-05 16:23:19 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-05 16:23:19 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-05 16:23:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:23:21 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 113
2025-07-05 16:23:21 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-05 16:23:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:23:21 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 113
2025-07-05 16:23:21 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-05 16:32:08 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=174 的状态为 1
2025-07-05 16:32:08 - summarizer - INFO - summarize_video:1862 - 开始处理单个视频总结: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/bfd0758da7974d02a58ee398d7c557cf.mp4
2025-07-05 16:32:08 - summarizer - INFO - summarize_video:1867 - 输入源为有效URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/bfd0758da7974d02a58ee398d7c557cf.mp4
2025-07-05 16:32:08 - summarizer - INFO - summarize_video:1899 - 向模型 'qwen-vl-max-latest' 发送视频总结请求，视频URL: https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/bfd0758da7974d02a58ee398d7c557cf.mp4
2025-07-05 16:32:10 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-05 16:32:10 - summarizer - ERROR - summarize_video:1924 - 使用模型分析视频 'https://ai-yuying.oss-cn-shenzhen.aliyuncs.com/knowledge-base/bfd0758da7974d02a58ee398d7c557cf.mp4' 时出错: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-42498253-e040-9538-893a-a3f90694a8fd', 'request_id': '42498253-e040-9538-893a-a3f90694a8fd'}
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/file_description.py", line 1914, in summarize_video
    response = self.client.chat.completions.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 925, in create
    return self._post(
           ^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/openai/_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-42498253-e040-9538-893a-a3f90694a8fd', 'request_id': '42498253-e040-9538-893a-a3f90694a8fd'}
2025-07-05 16:32:10 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=174 状态失败：更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-42498253-e040-9538-893a-a3f90694a8fd', 'request_id': '42498253-e040-9538-893a-a3f90694a8fd'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 174
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.ProgrammingError: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-42498253-e040-9538-893a-a3f90694a8fd', 'request_id': '42498253-e040-9538-893a-a3f90694a8fd'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 174
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.ProgrammingError) (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> Int' at line 4")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '分析视频时发生错误: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: The video modality input does not meet the requirements because: The video file is too long.', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-42498253-e040-9538-893a-a3f90694a8fd', 'request_id': '42498253-e040-9538-893a-a3f90694a8fd'}',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 174
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-05 16:37:16 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 16:37:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:37:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:37:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:37:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:37:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:37:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:37:21 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 16:41:29 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 31b84516-3eb6-477d-8d08-7d3f882ea48d
2025-07-05 16:41:29 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 31b84516-3eb6-477d-8d08-7d3f882ea48d
2025-07-05 16:41:29 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 31b84516-3eb6-477d-8d08-7d3f882ea48d
2025-07-05 16:41:29 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 31b84516-3eb6-477d-8d08-7d3f882ea48d, 状态码: 400
2025-07-05 16:42:26 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: f45cb118-9798-4daa-99ea-f27dab283efa
2025-07-05 16:42:26 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 49, 策略ID: 31, 请求ID: f45cb118-9798-4daa-99ea-f27dab283efa
2025-07-05 16:42:26 - api - INFO - create_role_api:63 - 提交角色创建任务到后台 - 请求ID: f45cb118-9798-4daa-99ea-f27dab283efa
2025-07-05 16:42:26 - api - INFO - create_role_api:66 - 角色创建任务已提交 - 请求ID: f45cb118-9798-4daa-99ea-f27dab283efa
2025-07-05 16:42:26 - utils - INFO - create_role:68 - 开始创建角色 - 租户ID: 1, 任务ID: 49, 策略ID: 31
2025-07-05 16:42:26 - utils - INFO - create_role:72 - 正在获取基础信息...
2025-07-05 16:42:29 - utils - INFO - create_role:74 - 基础信息获取完成: 763 条记录
2025-07-05 16:42:29 - utils - INFO - create_role:77 - 正在获取谈话风格...
2025-07-05 16:42:29 - utils - INFO - create_role:79 - 谈话风格获取完成: 1 条记录
2025-07-05 16:42:29 - utils - INFO - create_role:82 - 正在获取知识库...
2025-07-05 16:42:29 - utils - INFO - create_role:84 - 知识库获取完成: 0 条记录
2025-07-05 16:42:29 - utils - INFO - create_role:87 - 正在获取产品信息...
2025-07-05 16:42:29 - utils - INFO - create_role:89 - 产品信息获取完成: 0 条记录
2025-07-05 16:42:29 - utils - INFO - create_role:92 - 正在生成角色内容...
2025-07-05 16:43:44 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:43:44 - utils - INFO - create_role:94 - 角色内容生成完成，内容长度: 3847 字符
2025-07-05 16:43:44 - utils - INFO - create_role:97 - 正在提取禁止事项...
2025-07-05 16:43:44 - utils - INFO - extract_prohibit:23 - 开始提取禁止事项...
2025-07-05 16:43:46 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:43:46 - utils - INFO - extract_prohibit:32 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 16:43:46 - utils - INFO - create_role:101 - 正在提取销售流程...
2025-07-05 16:43:46 - utils - INFO - extract_sale_flow:42 - 开始提取销售流程...
2025-07-05 16:44:11 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:44:11 - utils - INFO - extract_sale_flow:51 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 16:44:11 - utils - INFO - create_role:105 - 正在发送禁止事项和销售流程通知...
2025-07-05 16:44:12 - utils - INFO - create_role:110 - 通知发送成功
2025-07-05 16:44:12 - utils - INFO - create_role:115 - 角色创建完成 - 租户ID: 1, 任务ID: 49
2025-07-05 16:44:12 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: f45cb118-9798-4daa-99ea-f27dab283efa, 状态码: 200
2025-07-05 16:44:12 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 9cb1610f-1138-437a-a6c8-edfe29e7d458
2025-07-05 16:44:12 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 9cb1610f-1138-437a-a6c8-edfe29e7d458
2025-07-05 16:44:12 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 9cb1610f-1138-437a-a6c8-edfe29e7d458
2025-07-05 16:44:12 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 9cb1610f-1138-437a-a6c8-edfe29e7d458, 状态码: 400
2025-07-05 16:48:58 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 0e2a1208-ada4-437d-a8c6-ddaddb137dec
2025-07-05 16:48:58 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 0e2a1208-ada4-437d-a8c6-ddaddb137dec
2025-07-05 16:48:58 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 0e2a1208-ada4-437d-a8c6-ddaddb137dec
2025-07-05 16:48:58 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 0e2a1208-ada4-437d-a8c6-ddaddb137dec, 状态码: 400
2025-07-05 16:49:02 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: e443f7de-af39-4677-aef2-25f8eac55e99
2025-07-05 16:49:02 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: e443f7de-af39-4677-aef2-25f8eac55e99
2025-07-05 16:49:02 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: e443f7de-af39-4677-aef2-25f8eac55e99
2025-07-05 16:49:02 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: e443f7de-af39-4677-aef2-25f8eac55e99, 状态码: 400
2025-07-05 16:49:12 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 71271ce0-a4c1-4ae2-ab8f-7e6f594c0c21
2025-07-05 16:49:12 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 71271ce0-a4c1-4ae2-ab8f-7e6f594c0c21
2025-07-05 16:49:12 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 71271ce0-a4c1-4ae2-ab8f-7e6f594c0c21
2025-07-05 16:49:12 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 71271ce0-a4c1-4ae2-ab8f-7e6f594c0c21, 状态码: 400
2025-07-05 16:49:13 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 3e0033ca-4dbb-4014-b028-91217df3fe28
2025-07-05 16:49:13 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 3e0033ca-4dbb-4014-b028-91217df3fe28
2025-07-05 16:49:13 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 3e0033ca-4dbb-4014-b028-91217df3fe28
2025-07-05 16:49:13 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 3e0033ca-4dbb-4014-b028-91217df3fe28, 状态码: 400
2025-07-05 16:49:35 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: fd1f4d9f-f46c-4db1-b4ee-2e17ca60158b
2025-07-05 16:49:35 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: fd1f4d9f-f46c-4db1-b4ee-2e17ca60158b
2025-07-05 16:49:35 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: fd1f4d9f-f46c-4db1-b4ee-2e17ca60158b
2025-07-05 16:49:35 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: fd1f4d9f-f46c-4db1-b4ee-2e17ca60158b, 状态码: 400
2025-07-05 16:49:38 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: c53b73ad-b419-4b81-a7ed-3190005135ea
2025-07-05 16:49:38 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: c53b73ad-b419-4b81-a7ed-3190005135ea
2025-07-05 16:49:38 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: c53b73ad-b419-4b81-a7ed-3190005135ea
2025-07-05 16:49:38 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: c53b73ad-b419-4b81-a7ed-3190005135ea, 状态码: 400
2025-07-05 16:49:51 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 16:49:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:49:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:49:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:49:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:49:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:49:59 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:49:59 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 16:49:59 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 16:49:59 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 16:49:59 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 16:49:59 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 16:50:04 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:50:04 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:50:04 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:50:04 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:50:04 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:50:04 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:50:05 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 16:50:06 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 9c1207c4-77a9-4367-b197-439c97fd6b0a
2025-07-05 16:50:06 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 9c1207c4-77a9-4367-b197-439c97fd6b0a
2025-07-05 16:50:06 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 9c1207c4-77a9-4367-b197-439c97fd6b0a
2025-07-05 16:50:06 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 9c1207c4-77a9-4367-b197-439c97fd6b0a, 状态码: 400
2025-07-05 16:51:01 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: a6396319-95d2-478e-a903-e61c9dc6e2eb
2025-07-05 16:51:01 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: a6396319-95d2-478e-a903-e61c9dc6e2eb
2025-07-05 16:51:01 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: a6396319-95d2-478e-a903-e61c9dc6e2eb
2025-07-05 16:51:01 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: a6396319-95d2-478e-a903-e61c9dc6e2eb, 状态码: 400
2025-07-05 16:51:47 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 16:51:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:51:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:51:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:51:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:51:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:51:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:51:53 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 16:51:57 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 373e36da-a59e-4cfe-8ce2-a1ebab2319d0
2025-07-05 16:51:57 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: , 任务ID: str, 策略ID: , 请求ID: 373e36da-a59e-4cfe-8ce2-a1ebab2319d0
2025-07-05 16:51:57 - api - WARNING - create_role_api:59 - 参数验证失败: 缺少必要参数: tenant_id, task_id, strategy_id, 请求ID: 373e36da-a59e-4cfe-8ce2-a1ebab2319d0。tenant_id: , task_id: str, strategy_id: 
2025-07-05 16:51:57 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 373e36da-a59e-4cfe-8ce2-a1ebab2319d0, 状态码: 400
2025-07-05 16:52:13 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: ebecacc3-3425-437c-9d51-824f8d0c89a1
2025-07-05 16:52:13 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: ebecacc3-3425-437c-9d51-824f8d0c89a1
2025-07-05 16:52:13 - api - INFO - create_role_api:63 - 提交角色创建任务到后台 - 请求ID: ebecacc3-3425-437c-9d51-824f8d0c89a1
2025-07-05 16:52:13 - api - INFO - create_role_api:66 - 角色创建任务已提交 - 请求ID: ebecacc3-3425-437c-9d51-824f8d0c89a1
2025-07-05 16:52:13 - utils - INFO - create_role:68 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 16:52:13 - utils - INFO - create_role:72 - 正在获取基础信息...
2025-07-05 16:52:13 - utils - INFO - create_role:74 - 基础信息获取完成: 766 条记录
2025-07-05 16:52:13 - utils - INFO - create_role:77 - 正在获取谈话风格...
2025-07-05 16:52:13 - utils - INFO - create_role:79 - 谈话风格获取完成: 237 条记录
2025-07-05 16:52:13 - utils - INFO - create_role:82 - 正在获取知识库...
2025-07-05 16:52:14 - utils - INFO - create_role:84 - 知识库获取完成: 690 条记录
2025-07-05 16:52:14 - utils - INFO - create_role:87 - 正在获取产品信息...
2025-07-05 16:52:14 - utils - INFO - create_role:89 - 产品信息获取完成: 920 条记录
2025-07-05 16:52:14 - utils - INFO - create_role:92 - 正在生成角色内容...
2025-07-05 16:53:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:53:03 - utils - INFO - create_role:94 - 角色内容生成完成，内容长度: 2609 字符
2025-07-05 16:53:03 - utils - INFO - create_role:97 - 正在提取禁止事项...
2025-07-05 16:53:03 - utils - INFO - extract_prohibit:23 - 开始提取禁止事项...
2025-07-05 16:53:05 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:53:05 - utils - INFO - extract_prohibit:32 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 16:53:05 - utils - INFO - create_role:101 - 正在提取销售流程...
2025-07-05 16:53:05 - utils - INFO - extract_sale_flow:42 - 开始提取销售流程...
2025-07-05 16:53:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:53:27 - utils - INFO - extract_sale_flow:51 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 16:53:27 - utils - INFO - create_role:105 - 正在发送禁止事项和销售流程通知...
2025-07-05 16:53:29 - utils - INFO - create_role:110 - 通知发送成功
2025-07-05 16:53:29 - utils - INFO - create_role:115 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 16:53:29 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: ebecacc3-3425-437c-9d51-824f8d0c89a1, 状态码: 200
2025-07-05 16:55:02 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 16:55:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:08 - api - INFO - startup_event:105 - 角色创建服务启动完成
2025-07-05 16:55:24 - api - INFO - shutdown_event:110 - 角色创建服务正在关闭
2025-07-05 16:55:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:29 - api - INFO - startup_event:117 - 角色创建服务启动完成
2025-07-05 16:55:47 - api - INFO - shutdown_event:122 - 角色创建服务正在关闭
2025-07-05 16:55:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:52 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 16:55:53 - api - INFO - startup_event:117 - 角色创建服务启动完成
2025-07-05 16:57:26 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: ed9e76c9-e4ca-4a4d-a450-ec295d5d57bc
2025-07-05 16:57:26 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 49, 策略ID: 31, 请求ID: ed9e76c9-e4ca-4a4d-a450-ec295d5d57bc
2025-07-05 16:57:26 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: ed9e76c9-e4ca-4a4d-a450-ec295d5d57bc
2025-07-05 16:57:26 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: ed9e76c9-e4ca-4a4d-a450-ec295d5d57bc
2025-07-05 16:57:26 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 1, 任务ID: 49, 策略ID: 31
2025-07-05 16:57:26 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 16:57:26 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: ed9e76c9-e4ca-4a4d-a450-ec295d5d57bc, 状态码: 200
2025-07-05 16:57:26 - utils - INFO - create_role:81 - 基础信息获取完成: 763 条记录
2025-07-05 16:57:26 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 16:57:26 - utils - INFO - create_role:88 - 谈话风格获取完成: 1 条记录
2025-07-05 16:57:26 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 16:57:26 - utils - INFO - create_role:95 - 知识库获取完成: 0 条记录
2025-07-05 16:57:26 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 16:57:26 - utils - INFO - create_role:102 - 产品信息获取完成: 0 条记录
2025-07-05 16:57:26 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 16:58:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:58:53 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 4549 字符
2025-07-05 16:58:53 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 16:58:53 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 16:58:56 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:58:56 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 16:58:56 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 16:58:56 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 16:59:26 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 16:59:26 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 16:59:26 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 16:59:27 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 16:59:27 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 1, 任务ID: 49
2025-07-05 16:59:27 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 49
2025-07-05 16:59:27 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 1bb0d543-0ec2-4f31-93c0-eafb7d64c313
2025-07-05 16:59:27 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 61c8785e-b093-4c38-b332-bad4ef77e6c2
2025-07-05 16:59:27 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 1bb0d543-0ec2-4f31-93c0-eafb7d64c313
2025-07-05 16:59:27 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 1bb0d543-0ec2-4f31-93c0-eafb7d64c313
2025-07-05 16:59:27 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: 1bb0d543-0ec2-4f31-93c0-eafb7d64c313
2025-07-05 16:59:27 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 50, 策略ID: 32, 请求ID: 61c8785e-b093-4c38-b332-bad4ef77e6c2
2025-07-05 16:59:27 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 61c8785e-b093-4c38-b332-bad4ef77e6c2
2025-07-05 16:59:27 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: 61c8785e-b093-4c38-b332-bad4ef77e6c2
2025-07-05 16:59:27 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 16:59:27 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 16:59:27 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 1, 任务ID: 50, 策略ID: 32
2025-07-05 16:59:27 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 16:59:27 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 1bb0d543-0ec2-4f31-93c0-eafb7d64c313, 状态码: 200
2025-07-05 16:59:27 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 61c8785e-b093-4c38-b332-bad4ef77e6c2, 状态码: 200
2025-07-05 16:59:27 - utils - INFO - create_role:81 - 基础信息获取完成: 766 条记录
2025-07-05 16:59:27 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 16:59:27 - utils - INFO - create_role:88 - 谈话风格获取完成: 237 条记录
2025-07-05 16:59:27 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 16:59:27 - utils - INFO - create_role:95 - 知识库获取完成: 690 条记录
2025-07-05 16:59:27 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 16:59:27 - utils - INFO - create_role:81 - 基础信息获取完成: 763 条记录
2025-07-05 16:59:27 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 16:59:27 - utils - INFO - create_role:102 - 产品信息获取完成: 920 条记录
2025-07-05 16:59:27 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:00:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:00:17 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 2875 字符
2025-07-05 17:00:17 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:00:17 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:00:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:00:21 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:00:21 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:00:21 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:00:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:00:43 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:00:43 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:00:44 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:00:44 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:00:44 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:00:44 - utils - INFO - create_role:88 - 谈话风格获取完成: 1 条记录
2025-07-05 17:00:44 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:00:44 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 391264be-6100-42fe-9c3b-1169d90a198e
2025-07-05 17:00:44 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 047d3110-44c0-434f-8aed-6816142b30ee
2025-07-05 17:00:44 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: c2a1b0bb-9c29-4174-a56a-58c587793f54
2025-07-05 17:00:44 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 391264be-6100-42fe-9c3b-1169d90a198e
2025-07-05 17:00:44 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 391264be-6100-42fe-9c3b-1169d90a198e
2025-07-05 17:00:44 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: 391264be-6100-42fe-9c3b-1169d90a198e
2025-07-05 17:00:44 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 17:00:44 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 17:00:44 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 391264be-6100-42fe-9c3b-1169d90a198e, 状态码: 200
2025-07-05 17:00:44 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 50, 策略ID: 32, 请求ID: 047d3110-44c0-434f-8aed-6816142b30ee
2025-07-05 17:00:44 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 047d3110-44c0-434f-8aed-6816142b30ee
2025-07-05 17:00:44 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: 047d3110-44c0-434f-8aed-6816142b30ee
2025-07-05 17:00:44 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 50, 策略ID: 32, 请求ID: c2a1b0bb-9c29-4174-a56a-58c587793f54
2025-07-05 17:00:44 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: c2a1b0bb-9c29-4174-a56a-58c587793f54
2025-07-05 17:00:44 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: c2a1b0bb-9c29-4174-a56a-58c587793f54
2025-07-05 17:00:44 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 1, 任务ID: 50, 策略ID: 32
2025-07-05 17:00:44 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 17:00:44 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 1, 任务ID: 50, 策略ID: 32
2025-07-05 17:00:44 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 17:00:44 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 047d3110-44c0-434f-8aed-6816142b30ee, 状态码: 200
2025-07-05 17:00:44 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: c2a1b0bb-9c29-4174-a56a-58c587793f54, 状态码: 200
2025-07-05 17:00:44 - utils - INFO - create_role:81 - 基础信息获取完成: 766 条记录
2025-07-05 17:00:44 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 17:00:44 - utils - INFO - create_role:95 - 知识库获取完成: 0 条记录
2025-07-05 17:00:44 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:00:44 - utils - INFO - create_role:88 - 谈话风格获取完成: 237 条记录
2025-07-05 17:00:44 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:00:44 - utils - INFO - create_role:102 - 产品信息获取完成: 0 条记录
2025-07-05 17:00:44 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:02:01 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:02:01 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 3531 字符
2025-07-05 17:02:01 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:02:01 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:02:04 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:02:04 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:02:04 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:02:04 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:02:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:02:27 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:02:27 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:02:28 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:02:28 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 1, 任务ID: 50
2025-07-05 17:02:28 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 50
2025-07-05 17:02:28 - utils - INFO - create_role:95 - 知识库获取完成: 690 条记录
2025-07-05 17:02:28 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:02:28 - utils - INFO - create_role:81 - 基础信息获取完成: 763 条记录
2025-07-05 17:02:28 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 17:02:28 - utils - INFO - create_role:81 - 基础信息获取完成: 763 条记录
2025-07-05 17:02:28 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 17:02:28 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 6879fd93-8133-4c7f-8939-ec3f4cdcfbee
2025-07-05 17:02:28 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: 26275177-9caf-413f-bb0f-925191f56030
2025-07-05 17:02:28 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 6879fd93-8133-4c7f-8939-ec3f4cdcfbee
2025-07-05 17:02:28 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 6879fd93-8133-4c7f-8939-ec3f4cdcfbee
2025-07-05 17:02:28 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: 6879fd93-8133-4c7f-8939-ec3f4cdcfbee
2025-07-05 17:02:28 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 17:02:28 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 17:02:28 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 6879fd93-8133-4c7f-8939-ec3f4cdcfbee, 状态码: 200
2025-07-05 17:02:28 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 52, 策略ID: 33, 请求ID: 26275177-9caf-413f-bb0f-925191f56030
2025-07-05 17:02:28 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 26275177-9caf-413f-bb0f-925191f56030
2025-07-05 17:02:28 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: 26275177-9caf-413f-bb0f-925191f56030
2025-07-05 17:02:28 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 1, 任务ID: 52, 策略ID: 33
2025-07-05 17:02:28 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 17:02:28 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: 26275177-9caf-413f-bb0f-925191f56030, 状态码: 200
2025-07-05 17:02:28 - utils - INFO - create_role:88 - 谈话风格获取完成: 1 条记录
2025-07-05 17:02:28 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:02:28 - utils - INFO - create_role:102 - 产品信息获取完成: 920 条记录
2025-07-05 17:02:28 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:03:56 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:03:56 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 4534 字符
2025-07-05 17:03:56 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:03:56 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:04:01 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:04:01 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:04:01 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:04:01 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:04:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:04:27 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:04:27 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:04:28 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:04:28 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:04:28 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:04:28 - utils - INFO - create_role:88 - 谈话风格获取完成: 1 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:04:28 - utils - INFO - create_role:81 - 基础信息获取完成: 766 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 17:04:28 - utils - INFO - create_role:95 - 知识库获取完成: 0 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:04:28 - utils - INFO - create_role:81 - 基础信息获取完成: 763 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 17:04:28 - utils - INFO - create_role:88 - 谈话风格获取完成: 1 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:04:28 - utils - INFO - create_role:88 - 谈话风格获取完成: 237 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:04:28 - utils - INFO - create_role:95 - 知识库获取完成: 0 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:04:28 - utils - INFO - create_role:102 - 产品信息获取完成: 0 条记录
2025-07-05 17:04:28 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:05:40 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:05:40 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 3622 字符
2025-07-05 17:05:40 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:05:40 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:05:44 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:05:44 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:05:44 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:05:44 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:06:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:06:07 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:06:07 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:06:08 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:06:08 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 1, 任务ID: 50
2025-07-05 17:06:08 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 50
2025-07-05 17:06:08 - utils - INFO - create_role:95 - 知识库获取完成: 690 条记录
2025-07-05 17:06:08 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:06:08 - utils - INFO - create_role:95 - 知识库获取完成: 0 条记录
2025-07-05 17:06:08 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:06:08 - utils - INFO - create_role:102 - 产品信息获取完成: 0 条记录
2025-07-05 17:06:08 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:07:10 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:07:10 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 2932 字符
2025-07-05 17:07:10 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:07:10 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:07:14 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:07:14 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:07:14 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:07:14 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:07:35 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:07:35 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:07:35 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:07:36 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:07:36 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 1, 任务ID: 50
2025-07-05 17:07:36 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 50
2025-07-05 17:07:36 - utils - INFO - create_role:102 - 产品信息获取完成: 920 条记录
2025-07-05 17:07:36 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:08:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:08:43 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 3447 字符
2025-07-05 17:08:43 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:08:43 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:08:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:08:48 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:08:48 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:08:48 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:09:11 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:09:11 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:09:11 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:09:12 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:09:12 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:09:12 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:09:12 - utils - INFO - create_role:102 - 产品信息获取完成: 0 条记录
2025-07-05 17:09:12 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:10:28 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:10:28 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 3564 字符
2025-07-05 17:10:28 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:10:28 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:10:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:10:30 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:10:30 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:10:30 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:10:52 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:10:52 - utils - INFO - extract_sale_flow:56 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:10:52 - utils - INFO - create_role:118 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:10:53 - utils - INFO - create_role:123 - 通知发送成功
2025-07-05 17:10:53 - utils - INFO - create_role:128 - 角色创建完成 - 租户ID: 1, 任务ID: 52
2025-07-05 17:10:53 - utils - INFO - create_role_background:141 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 52
2025-07-05 17:10:53 - api - INFO - add_request_id:20 - 收到请求: POST /create_role, 请求ID: fe339496-fc9b-4dde-a83a-2120fe233b3f
2025-07-05 17:10:53 - api - INFO - create_role_api:53 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 52, 策略ID: 33, 请求ID: fe339496-fc9b-4dde-a83a-2120fe233b3f
2025-07-05 17:10:53 - api - INFO - create_role_api:63 - 立即返回响应，提交角色创建任务到后台 - 请求ID: fe339496-fc9b-4dde-a83a-2120fe233b3f
2025-07-05 17:10:53 - api - INFO - create_role_api:75 - 角色创建任务已提交到后台 - 请求ID: fe339496-fc9b-4dde-a83a-2120fe233b3f
2025-07-05 17:10:53 - utils - INFO - create_role:73 - 开始创建角色 - 租户ID: 1, 任务ID: 52, 策略ID: 33
2025-07-05 17:10:53 - utils - INFO - create_role:77 - 正在获取基础信息...
2025-07-05 17:10:53 - api - INFO - add_request_id:22 - 请求处理完成: POST /create_role, 请求ID: fe339496-fc9b-4dde-a83a-2120fe233b3f, 状态码: 200
2025-07-05 17:10:53 - utils - INFO - create_role:81 - 基础信息获取完成: 763 条记录
2025-07-05 17:10:53 - utils - INFO - create_role:84 - 正在获取谈话风格...
2025-07-05 17:10:53 - utils - INFO - create_role:88 - 谈话风格获取完成: 1 条记录
2025-07-05 17:10:53 - utils - INFO - create_role:91 - 正在获取知识库...
2025-07-05 17:10:53 - utils - INFO - create_role:95 - 知识库获取完成: 0 条记录
2025-07-05 17:10:53 - utils - INFO - create_role:98 - 正在获取产品信息...
2025-07-05 17:10:53 - utils - INFO - create_role:102 - 产品信息获取完成: 0 条记录
2025-07-05 17:10:53 - utils - INFO - create_role:105 - 正在生成角色内容...
2025-07-05 17:11:45 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:11:45 - utils - INFO - create_role:107 - 角色内容生成完成，内容长度: 2478 字符
2025-07-05 17:11:45 - utils - INFO - create_role:110 - 正在提取禁止事项...
2025-07-05 17:11:45 - utils - INFO - extract_prohibit:28 - 开始提取禁止事项...
2025-07-05 17:11:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:11:48 - utils - INFO - extract_prohibit:37 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:11:48 - utils - INFO - create_role:114 - 正在提取销售流程...
2025-07-05 17:11:48 - utils - INFO - extract_sale_flow:47 - 开始提取销售流程...
2025-07-05 17:12:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:21 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:21 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 17:12:21 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 17:12:21 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 17:12:21 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 17:12:21 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 17:12:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:12:26 - api - INFO - startup_event:204 - 角色创建服务启动完成
2025-07-05 17:13:14 - api - INFO - add_request_id:69 - 收到请求: POST /create_role, 请求ID: ad969c33-fb83-4f33-a420-30f30c137d20
2025-07-05 17:13:14 - api - INFO - create_role_api:113 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: ad969c33-fb83-4f33-a420-30f30c137d20
2025-07-05 17:13:14 - api - INFO - create_role_api:123 - 立即返回响应，提交角色创建任务到后台 - 请求ID: ad969c33-fb83-4f33-a420-30f30c137d20
2025-07-05 17:13:14 - api - INFO - add_task:27 - 任务已添加到管理器: ad969c33-fb83-4f33-a420-30f30c137d20, 当前活跃任务数: 1
2025-07-05 17:13:14 - api - INFO - create_role_api:141 - 角色创建任务已提交到后台 - 请求ID: ad969c33-fb83-4f33-a420-30f30c137d20
2025-07-05 17:13:14 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 17:13:14 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 17:13:14 - api - INFO - add_request_id:71 - 请求处理完成: POST /create_role, 请求ID: ad969c33-fb83-4f33-a420-30f30c137d20, 状态码: 200
2025-07-05 17:13:15 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 17:13:15 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 17:14:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:14:48 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4790 字符
2025-07-05 17:14:48 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 17:14:48 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 17:14:54 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:14:54 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:14:54 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 17:15:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:15:21 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:15:21 - api - INFO - add_request_id:69 - 收到请求: POST /create_role, 请求ID: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b
2025-07-05 17:15:21 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:15:23 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 17:15:23 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:15:23 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:15:23 - api - INFO - execute_role_creation_with_cleanup:99 - 角色创建任务执行完成 - 请求ID: ad969c33-fb83-4f33-a420-30f30c137d20
2025-07-05 17:15:23 - api - INFO - remove_task:35 - 任务已从管理器移除: ad969c33-fb83-4f33-a420-30f30c137d20, 当前活跃任务数: 0
2025-07-05 17:15:23 - api - INFO - create_role_api:113 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b
2025-07-05 17:15:23 - api - INFO - create_role_api:123 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b
2025-07-05 17:15:23 - api - INFO - add_task:27 - 任务已添加到管理器: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b, 当前活跃任务数: 1
2025-07-05 17:15:23 - api - INFO - create_role_api:141 - 角色创建任务已提交到后台 - 请求ID: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b
2025-07-05 17:15:23 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 17:15:23 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 17:15:23 - api - INFO - add_request_id:71 - 请求处理完成: POST /create_role, 请求ID: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b, 状态码: 200
2025-07-05 17:15:23 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 17:15:23 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 17:16:16 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:16:16 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3264 字符
2025-07-05 17:16:16 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 17:16:16 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 17:16:19 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:16:19 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:16:19 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 17:16:54 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:16:54 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:16:54 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:16:56 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 17:16:56 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:16:56 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:16:56 - api - INFO - execute_role_creation_with_cleanup:99 - 角色创建任务执行完成 - 请求ID: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b
2025-07-05 17:16:56 - api - INFO - remove_task:35 - 任务已从管理器移除: 9185d560-4a8d-4c7d-a834-0dd0e1e58b2b, 当前活跃任务数: 0
2025-07-05 17:20:09 - api - INFO - add_request_id:69 - 收到请求: POST /create_role, 请求ID: 3afd439e-6079-4c5a-bb74-be8b24861f15
2025-07-05 17:20:09 - api - INFO - create_role_api:113 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 3afd439e-6079-4c5a-bb74-be8b24861f15
2025-07-05 17:20:09 - api - INFO - create_role_api:123 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 3afd439e-6079-4c5a-bb74-be8b24861f15
2025-07-05 17:20:09 - api - INFO - add_task:27 - 任务已添加到管理器: 3afd439e-6079-4c5a-bb74-be8b24861f15, 当前活跃任务数: 1
2025-07-05 17:20:09 - api - INFO - create_role_api:141 - 角色创建任务已提交到后台 - 请求ID: 3afd439e-6079-4c5a-bb74-be8b24861f15
2025-07-05 17:20:09 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 17:20:09 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 17:20:09 - api - INFO - add_request_id:71 - 请求处理完成: POST /create_role, 请求ID: 3afd439e-6079-4c5a-bb74-be8b24861f15, 状态码: 200
2025-07-05 17:20:09 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 17:20:09 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 17:20:57 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:20:57 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2648 字符
2025-07-05 17:20:57 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 17:20:57 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 17:20:59 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:20:59 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:20:59 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 17:21:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:21:24 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:21:24 - api - INFO - add_request_id:69 - 收到请求: POST /create_role, 请求ID: 3788c194-6a7b-494b-be2b-f6f298566c0b
2025-07-05 17:21:24 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:21:25 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 17:21:25 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:21:25 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:21:25 - api - INFO - execute_role_creation_with_cleanup:99 - 角色创建任务执行完成 - 请求ID: 3afd439e-6079-4c5a-bb74-be8b24861f15
2025-07-05 17:21:25 - api - INFO - remove_task:35 - 任务已从管理器移除: 3afd439e-6079-4c5a-bb74-be8b24861f15, 当前活跃任务数: 0
2025-07-05 17:21:25 - api - INFO - create_role_api:113 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 3788c194-6a7b-494b-be2b-f6f298566c0b
2025-07-05 17:21:25 - api - INFO - create_role_api:123 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 3788c194-6a7b-494b-be2b-f6f298566c0b
2025-07-05 17:21:25 - api - INFO - add_task:27 - 任务已添加到管理器: 3788c194-6a7b-494b-be2b-f6f298566c0b, 当前活跃任务数: 1
2025-07-05 17:21:25 - api - INFO - create_role_api:141 - 角色创建任务已提交到后台 - 请求ID: 3788c194-6a7b-494b-be2b-f6f298566c0b
2025-07-05 17:21:25 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 17:21:25 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 17:21:26 - api - INFO - add_request_id:71 - 请求处理完成: POST /create_role, 请求ID: 3788c194-6a7b-494b-be2b-f6f298566c0b, 状态码: 200
2025-07-05 17:21:26 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 17:21:26 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 17:22:15 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:22:15 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3122 字符
2025-07-05 17:22:15 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 17:22:15 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 17:22:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:22:17 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 17:22:17 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 17:22:49 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 17:22:49 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 17:22:49 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 17:22:50 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 17:22:50 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:22:50 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 17:22:50 - api - INFO - execute_role_creation_with_cleanup:99 - 角色创建任务执行完成 - 请求ID: 3788c194-6a7b-494b-be2b-f6f298566c0b
2025-07-05 17:22:50 - api - INFO - remove_task:35 - 任务已从管理器移除: 3788c194-6a7b-494b-be2b-f6f298566c0b, 当前活跃任务数: 0
2025-07-05 17:22:50 - api - INFO - shutdown_event:209 - 角色创建服务正在关闭
2025-07-05 17:22:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:22:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:22:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:22:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:22:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:22:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:22:56 - api - INFO - startup_event:210 - 角色创建服务启动完成
2025-07-05 17:23:05 - api - INFO - shutdown_event:215 - 角色创建服务正在关闭
2025-07-05 17:23:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:23:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:23:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:23:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:23:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:23:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 17:23:11 - api - INFO - startup_event:210 - 角色创建服务启动完成
2025-07-05 18:00:57 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: f943263e-231e-413c-8e95-8fe7e5bf4b6b
2025-07-05 18:00:57 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 55, 策略ID: 36, 请求ID: f943263e-231e-413c-8e95-8fe7e5bf4b6b
2025-07-05 18:00:57 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: f943263e-231e-413c-8e95-8fe7e5bf4b6b
2025-07-05 18:00:57 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: f943263e-231e-413c-8e95-8fe7e5bf4b6b
2025-07-05 18:00:57 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 55, 策略ID: 36
2025-07-05 18:00:57 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:00:57 - api - INFO - _add_task_async:32 - 任务已添加到管理器: f943263e-231e-413c-8e95-8fe7e5bf4b6b, 当前活跃任务数: 1
2025-07-05 18:00:57 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: f943263e-231e-413c-8e95-8fe7e5bf4b6b, 状态码: 200
2025-07-05 18:00:57 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:00:57 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:02:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:02:27 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4047 字符
2025-07-05 18:02:27 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:02:27 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:02:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:02:30 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:02:30 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:02:59 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:02:59 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:02:59 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:03:01 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:03:01 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 55
2025-07-05 18:03:01 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 55
2025-07-05 18:03:01 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: f943263e-231e-413c-8e95-8fe7e5bf4b6b
2025-07-05 18:03:01 - api - INFO - remove_task:40 - 任务已从管理器移除: f943263e-231e-413c-8e95-8fe7e5bf4b6b, 当前活跃任务数: 0
2025-07-05 18:15:57 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 114cfa58-9110-4ad6-8270-a7f45e48b3f3
2025-07-05 18:15:57 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 53, 策略ID: 34, 请求ID: 114cfa58-9110-4ad6-8270-a7f45e48b3f3
2025-07-05 18:15:57 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 114cfa58-9110-4ad6-8270-a7f45e48b3f3
2025-07-05 18:15:57 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 114cfa58-9110-4ad6-8270-a7f45e48b3f3
2025-07-05 18:15:57 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 53, 策略ID: 34
2025-07-05 18:15:57 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:15:57 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 114cfa58-9110-4ad6-8270-a7f45e48b3f3, 当前活跃任务数: 1
2025-07-05 18:15:57 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 114cfa58-9110-4ad6-8270-a7f45e48b3f3, 状态码: 200
2025-07-05 18:15:57 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 2 条
2025-07-05 18:15:57 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:16:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:16:53 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3203 字符
2025-07-05 18:16:53 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:16:53 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:16:55 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:16:55 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:16:55 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:17:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:17:24 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:17:24 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:17:25 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:17:25 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 53
2025-07-05 18:17:25 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 53
2025-07-05 18:17:25 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: 114cfa58-9110-4ad6-8270-a7f45e48b3f3
2025-07-05 18:17:25 - api - INFO - remove_task:40 - 任务已从管理器移除: 114cfa58-9110-4ad6-8270-a7f45e48b3f3, 当前活跃任务数: 0
2025-07-05 18:24:51 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: ab81c120-6749-46cc-b175-0af7a2cb63c0
2025-07-05 18:24:51 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 58, 策略ID: 274, 请求ID: ab81c120-6749-46cc-b175-0af7a2cb63c0
2025-07-05 18:24:51 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: ab81c120-6749-46cc-b175-0af7a2cb63c0
2025-07-05 18:24:51 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: ab81c120-6749-46cc-b175-0af7a2cb63c0
2025-07-05 18:24:51 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 58, 策略ID: 274
2025-07-05 18:24:51 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:24:51 - api - INFO - _add_task_async:32 - 任务已添加到管理器: ab81c120-6749-46cc-b175-0af7a2cb63c0, 当前活跃任务数: 1
2025-07-05 18:24:51 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: ab81c120-6749-46cc-b175-0af7a2cb63c0, 状态码: 200
2025-07-05 18:24:51 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 0 条, 产品: 0 条
2025-07-05 18:24:51 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:25:59 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:25:59 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4002 字符
2025-07-05 18:25:59 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:25:59 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:26:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:26:03 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:26:03 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:26:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:26:27 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:26:27 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:26:28 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:26:28 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 58
2025-07-05 18:26:28 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 58
2025-07-05 18:26:28 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: ab81c120-6749-46cc-b175-0af7a2cb63c0
2025-07-05 18:26:28 - api - INFO - remove_task:40 - 任务已从管理器移除: ab81c120-6749-46cc-b175-0af7a2cb63c0, 当前活跃任务数: 0
2025-07-05 18:26:28 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 4625476d-9bd0-49ee-affb-16f8edc99cfc
2025-07-05 18:26:28 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 9f9db973-093e-46ba-a8fb-bc6193af1430
2025-07-05 18:26:28 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 58, 策略ID: 274, 请求ID: 4625476d-9bd0-49ee-affb-16f8edc99cfc
2025-07-05 18:26:28 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 4625476d-9bd0-49ee-affb-16f8edc99cfc
2025-07-05 18:26:28 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 4625476d-9bd0-49ee-affb-16f8edc99cfc
2025-07-05 18:26:28 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 59, 策略ID: 275, 请求ID: 9f9db973-093e-46ba-a8fb-bc6193af1430
2025-07-05 18:26:28 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 9f9db973-093e-46ba-a8fb-bc6193af1430
2025-07-05 18:26:28 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 9f9db973-093e-46ba-a8fb-bc6193af1430
2025-07-05 18:26:28 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 58, 策略ID: 274
2025-07-05 18:26:28 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:26:28 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 4625476d-9bd0-49ee-affb-16f8edc99cfc, 当前活跃任务数: 1
2025-07-05 18:26:28 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 59, 策略ID: 275
2025-07-05 18:26:28 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:26:28 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 9f9db973-093e-46ba-a8fb-bc6193af1430, 当前活跃任务数: 2
2025-07-05 18:26:28 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 4625476d-9bd0-49ee-affb-16f8edc99cfc, 状态码: 200
2025-07-05 18:26:28 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 9f9db973-093e-46ba-a8fb-bc6193af1430, 状态码: 200
2025-07-05 18:26:28 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 0 条, 产品: 0 条
2025-07-05 18:26:28 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:27:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:27:17 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2746 字符
2025-07-05 18:27:17 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:27:17 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:27:20 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:27:20 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:27:20 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:27:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:27:43 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:27:43 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:27:43 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:29:11 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:29:11 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4354 字符
2025-07-05 18:29:11 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:29:11 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:29:12 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:29:12 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 58
2025-07-05 18:29:12 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 58
2025-07-05 18:29:12 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: 4625476d-9bd0-49ee-affb-16f8edc99cfc
2025-07-05 18:29:12 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:29:14 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:29:14 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:29:14 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:29:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:29:43 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:29:43 - api - INFO - remove_task:40 - 任务已从管理器移除: 4625476d-9bd0-49ee-affb-16f8edc99cfc, 当前活跃任务数: 1
2025-07-05 18:29:43 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: a8574cc4-89f5-4acd-bd75-3f3a751a1c21
2025-07-05 18:29:43 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:29:44 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:29:44 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 59
2025-07-05 18:29:44 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 59
2025-07-05 18:29:44 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: 9f9db973-093e-46ba-a8fb-bc6193af1430
2025-07-05 18:29:44 - api - INFO - remove_task:40 - 任务已从管理器移除: 9f9db973-093e-46ba-a8fb-bc6193af1430, 当前活跃任务数: 0
2025-07-05 18:29:44 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: baa68763-1ff4-46b7-b1b5-4971ae68e266
2025-07-05 18:29:44 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f
2025-07-05 18:29:44 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 60, 策略ID: 276, 请求ID: a8574cc4-89f5-4acd-bd75-3f3a751a1c21
2025-07-05 18:29:44 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: a8574cc4-89f5-4acd-bd75-3f3a751a1c21
2025-07-05 18:29:44 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: a8574cc4-89f5-4acd-bd75-3f3a751a1c21
2025-07-05 18:29:44 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 60, 策略ID: 276
2025-07-05 18:29:44 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:29:44 - api - INFO - _add_task_async:32 - 任务已添加到管理器: a8574cc4-89f5-4acd-bd75-3f3a751a1c21, 当前活跃任务数: 1
2025-07-05 18:29:44 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: a8574cc4-89f5-4acd-bd75-3f3a751a1c21, 状态码: 200
2025-07-05 18:29:44 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 60, 策略ID: 276, 请求ID: baa68763-1ff4-46b7-b1b5-4971ae68e266
2025-07-05 18:29:44 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: baa68763-1ff4-46b7-b1b5-4971ae68e266
2025-07-05 18:29:44 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: baa68763-1ff4-46b7-b1b5-4971ae68e266
2025-07-05 18:29:44 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 61, 策略ID: 277, 请求ID: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f
2025-07-05 18:29:44 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f
2025-07-05 18:29:44 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f
2025-07-05 18:29:44 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 60, 策略ID: 276
2025-07-05 18:29:44 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:29:44 - api - INFO - _add_task_async:32 - 任务已添加到管理器: baa68763-1ff4-46b7-b1b5-4971ae68e266, 当前活跃任务数: 2
2025-07-05 18:29:44 - api - INFO - cleanup_completed_tasks:64 - 清理了 1 个已完成的任务
2025-07-05 18:29:44 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 61, 策略ID: 277
2025-07-05 18:29:44 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:29:44 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f, 当前活跃任务数: 2
2025-07-05 18:29:44 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: baa68763-1ff4-46b7-b1b5-4971ae68e266, 状态码: 200
2025-07-05 18:29:44 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f, 状态码: 200
2025-07-05 18:29:44 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:29:44 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:30:54 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:30:54 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3874 字符
2025-07-05 18:30:54 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:30:54 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:30:57 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:30:57 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:30:57 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:31:20 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:31:20 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:31:20 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:31:20 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:32:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:32:17 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3324 字符
2025-07-05 18:32:17 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:32:17 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:32:17 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:33:20 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:33:20 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2941 字符
2025-07-05 18:33:20 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:33:20 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:33:21 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:33:21 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 60
2025-07-05 18:33:21 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 60
2025-07-05 18:33:21 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: a8574cc4-89f5-4acd-bd75-3f3a751a1c21
2025-07-05 18:33:21 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:33:23 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:33:23 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:33:23 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:33:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:33:53 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:33:53 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:33:55 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:33:55 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:33:55 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:34:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:34:21 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:34:21 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:34:22 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:34:22 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 60
2025-07-05 18:34:22 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 60
2025-07-05 18:34:22 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: baa68763-1ff4-46b7-b1b5-4971ae68e266
2025-07-05 18:34:22 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:34:23 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:34:23 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 61
2025-07-05 18:34:23 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 61
2025-07-05 18:34:23 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f
2025-07-05 18:34:23 - api - INFO - remove_task:40 - 任务已从管理器移除: baa68763-1ff4-46b7-b1b5-4971ae68e266, 当前活跃任务数: 1
2025-07-05 18:34:23 - api - INFO - remove_task:40 - 任务已从管理器移除: 279d41e9-0bad-4aaa-8b3a-9f99fba95d2f, 当前活跃任务数: 0
2025-07-05 18:34:23 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: f2c028e6-1209-4124-827f-627138065446
2025-07-05 18:34:23 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: f2c028e6-1209-4124-827f-627138065446
2025-07-05 18:34:23 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: f2c028e6-1209-4124-827f-627138065446
2025-07-05 18:34:23 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: f2c028e6-1209-4124-827f-627138065446
2025-07-05 18:34:23 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:34:23 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:34:23 - api - INFO - _add_task_async:32 - 任务已添加到管理器: f2c028e6-1209-4124-827f-627138065446, 当前活跃任务数: 1
2025-07-05 18:34:23 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: f2c028e6-1209-4124-827f-627138065446, 状态码: 200
2025-07-05 18:34:23 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:34:23 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:35:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:20 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 18:35:20 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 18:35:20 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 18:35:20 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 18:35:20 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 18:35:25 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:25 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:25 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:25 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:25 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:25 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:35:25 - api - INFO - startup_event:210 - 角色创建服务启动完成
2025-07-05 18:35:26 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 2c8ef8d2-ad82-4e1a-9278-c447ffa8e81d
2025-07-05 18:35:26 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 2c8ef8d2-ad82-4e1a-9278-c447ffa8e81d
2025-07-05 18:35:26 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 2c8ef8d2-ad82-4e1a-9278-c447ffa8e81d
2025-07-05 18:35:26 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 2c8ef8d2-ad82-4e1a-9278-c447ffa8e81d
2025-07-05 18:35:26 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:35:26 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:35:26 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 2c8ef8d2-ad82-4e1a-9278-c447ffa8e81d, 当前活跃任务数: 1
2025-07-05 18:35:26 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 2c8ef8d2-ad82-4e1a-9278-c447ffa8e81d, 状态码: 200
2025-07-05 18:35:27 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:35:27 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:37:00 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:37:00 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4538 字符
2025-07-05 18:37:00 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:37:00 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:37:05 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:37:05 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:37:05 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:37:23 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:23 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:23 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:23 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:23 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:23 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:23 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 18:37:23 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 18:37:23 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 18:37:23 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 18:37:23 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 18:37:28 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:28 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:28 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:28 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:28 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:28 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:37:28 - api - INFO - startup_event:210 - 角色创建服务启动完成
2025-07-05 18:37:34 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17
2025-07-05 18:37:34 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17
2025-07-05 18:37:34 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17
2025-07-05 18:37:34 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17
2025-07-05 18:37:34 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:37:34 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:37:34 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17, 当前活跃任务数: 1
2025-07-05 18:37:34 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17, 状态码: 200
2025-07-05 18:37:35 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:37:35 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:38:34 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:38:34 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2919 字符
2025-07-05 18:38:34 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:38:34 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:38:36 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:38:36 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:38:36 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:39:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:39:07 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:39:07 - api - INFO - add_request_id:74 - 收到请求: POST /create_role, 请求ID: 7a259512-948e-4f75-8e4f-309892798b32
2025-07-05 18:39:07 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:39:09 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:39:09 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:39:09 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:39:09 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17
2025-07-05 18:39:09 - api - INFO - remove_task:40 - 任务已从管理器移除: 9d56e4b9-d0d9-493b-9d66-b46ffb73de17, 当前活跃任务数: 0
2025-07-05 18:39:09 - api - INFO - create_role_api:118 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 7a259512-948e-4f75-8e4f-309892798b32
2025-07-05 18:39:09 - api - INFO - create_role_api:128 - 立即返回响应，提交角色创建任务到后台 - 请求ID: 7a259512-948e-4f75-8e4f-309892798b32
2025-07-05 18:39:09 - api - INFO - create_role_api:146 - 角色创建任务已提交到后台 - 请求ID: 7a259512-948e-4f75-8e4f-309892798b32
2025-07-05 18:39:09 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:39:09 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:39:09 - api - INFO - _add_task_async:32 - 任务已添加到管理器: 7a259512-948e-4f75-8e4f-309892798b32, 当前活跃任务数: 1
2025-07-05 18:39:09 - api - INFO - add_request_id:76 - 请求处理完成: POST /create_role, 请求ID: 7a259512-948e-4f75-8e4f-309892798b32, 状态码: 200
2025-07-05 18:39:09 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:39:09 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:40:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:40:30 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4571 字符
2025-07-05 18:40:30 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:40:30 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:40:33 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:40:33 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:40:33 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:41:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:41:03 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:41:03 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:41:05 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:41:05 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:41:05 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:41:05 - api - INFO - execute_role_creation_with_cleanup:104 - 角色创建任务执行完成 - 请求ID: 7a259512-948e-4f75-8e4f-309892798b32
2025-07-05 18:41:05 - api - INFO - shutdown_event:215 - 角色创建服务正在关闭
2025-07-05 18:41:05 - api - INFO - shutdown_event:219 - 等待 1 个活跃任务完成...
2025-07-05 18:41:05 - api - INFO - shutdown_event:221 - 所有任务已完成
2025-07-05 18:41:05 - api - INFO - remove_task:40 - 任务已从管理器移除: 7a259512-948e-4f75-8e4f-309892798b32, 当前活跃任务数: 0
2025-07-05 18:41:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:10 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:10 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 18:41:33 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 18:41:38 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:38 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:38 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:38 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:38 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:38 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:41:39 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 18:42:07 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 18:42:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:42:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:42:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:42:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:42:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:42:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 18:42:16 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 18:43:05 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37
2025-07-05 18:43:05 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37
2025-07-05 18:43:05 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37
2025-07-05 18:43:05 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37
2025-07-05 18:43:05 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37
2025-07-05 18:43:05 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37, 状态码: 200
2025-07-05 18:43:05 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:05 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:06 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:06 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:43:07 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da
2025-07-05 18:43:07 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da
2025-07-05 18:43:07 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da
2025-07-05 18:43:07 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da
2025-07-05 18:43:07 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da
2025-07-05 18:43:07 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da, 状态码: 200
2025-07-05 18:43:07 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:07 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:07 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:07 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:43:08 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c
2025-07-05 18:43:08 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c
2025-07-05 18:43:08 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c
2025-07-05 18:43:08 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c
2025-07-05 18:43:08 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c
2025-07-05 18:43:08 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c, 状态码: 200
2025-07-05 18:43:08 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:08 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:08 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:08 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:43:09 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198
2025-07-05 18:43:09 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198
2025-07-05 18:43:09 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198
2025-07-05 18:43:09 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198
2025-07-05 18:43:09 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198
2025-07-05 18:43:09 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:09 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:09 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198, 状态码: 200
2025-07-05 18:43:09 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:09 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:43:10 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987
2025-07-05 18:43:10 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987
2025-07-05 18:43:10 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987
2025-07-05 18:43:10 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987
2025-07-05 18:43:10 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987
2025-07-05 18:43:10 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987, 状态码: 200
2025-07-05 18:43:10 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:10 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:10 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:10 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:43:11 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5
2025-07-05 18:43:11 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5
2025-07-05 18:43:11 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5
2025-07-05 18:43:11 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5
2025-07-05 18:43:11 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5
2025-07-05 18:43:11 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5, 状态码: 200
2025-07-05 18:43:11 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:11 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:11 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:11 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:43:12 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b
2025-07-05 18:43:12 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b
2025-07-05 18:43:12 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b
2025-07-05 18:43:12 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b
2025-07-05 18:43:12 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b
2025-07-05 18:43:12 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b, 状态码: 200
2025-07-05 18:43:12 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 18:43:12 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:43:12 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 18:43:12 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:44:01 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:01 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2817 字符
2025-07-05 18:44:01 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:01 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:02 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:02 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3205 字符
2025-07-05 18:44:02 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:02 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:03 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:03 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:04 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:04 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:04 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:17 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4165 字符
2025-07-05 18:44:17 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:17 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:20 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:20 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4588 字符
2025-07-05 18:44:20 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:20 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:21 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:21 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:25 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:25 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:25 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:25 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:25 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:44:25 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:44:26 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:44:26 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:26 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:26 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: b47c4d92-7bc8-44ae-8006-35279a79d7da
2025-07-05 18:44:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:27 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4139 字符
2025-07-05 18:44:27 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:27 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:27 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:27 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4461 字符
2025-07-05 18:44:27 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:27 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:30 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:30 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:31 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:31 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:31 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:33 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:33 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:44:33 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:44:34 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:44:34 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:34 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:34 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 27df24ab-b95f-46ef-b8e4-190e052b0198
2025-07-05 18:44:36 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:36 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4086 字符
2025-07-05 18:44:36 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:44:36 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:44:40 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:40 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:44:40 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:44:49 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:49 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:44:49 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:44:49 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:49 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:44:49 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:44:50 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:44:50 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:50 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:50 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 9a71c5f2-a117-4138-9018-68c49a647a37
2025-07-05 18:44:50 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:44:50 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:50 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:50 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 50cfda47-0c7d-4be7-800d-a070f42999d5
2025-07-05 18:44:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:53 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:44:53 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:44:54 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:44:54 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:54 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:54 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: e7c3d262-5fa1-4b5a-9bd8-0850fbab366b
2025-07-05 18:44:58 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:44:58 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:44:58 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:44:59 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:44:59 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:59 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:44:59 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: cc506428-bec4-41ed-903d-3acb0fdb8d7c
2025-07-05 18:45:02 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:45:02 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:45:02 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:45:03 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:45:03 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:45:03 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 123, 任务ID: str
2025-07-05 18:45:03 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: d5c7ab02-4606-4516-9098-f65c5b670987
2025-07-05 18:45:04 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468
2025-07-05 18:45:04 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 62, 策略ID: 280, 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468
2025-07-05 18:45:04 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468
2025-07-05 18:45:04 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468
2025-07-05 18:45:04 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468
2025-07-05 18:45:04 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 62, 策略ID: 280
2025-07-05 18:45:04 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468, 状态码: 200
2025-07-05 18:45:04 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:45:04 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 2 条, 产品: 0 条
2025-07-05 18:45:04 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:46:28 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:46:28 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4295 字符
2025-07-05 18:46:28 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:46:28 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:46:31 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:46:31 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:46:31 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:46:51 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:46:51 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:46:51 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:46:52 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:46:52 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 62
2025-07-05 18:46:52 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 62
2025-07-05 18:46:52 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 9264f25c-5703-4f49-8afc-0638bb236468
2025-07-05 18:47:43 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895
2025-07-05 18:47:43 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 63, 策略ID: 281, 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895
2025-07-05 18:47:43 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895
2025-07-05 18:47:43 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895
2025-07-05 18:47:43 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895
2025-07-05 18:47:43 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895, 状态码: 200
2025-07-05 18:47:43 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 63, 策略ID: 281
2025-07-05 18:47:43 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:47:43 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:47:43 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:48:49 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347
2025-07-05 18:48:49 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 63, 策略ID: 281, 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347
2025-07-05 18:48:49 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347
2025-07-05 18:48:49 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347
2025-07-05 18:48:49 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347
2025-07-05 18:48:49 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 63, 策略ID: 281
2025-07-05 18:48:49 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347, 状态码: 200
2025-07-05 18:48:49 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:48:49 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:48:49 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:48:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:48:53 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3639 字符
2025-07-05 18:48:53 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:48:53 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:48:56 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:48:56 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:48:56 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:49:23 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:49:23 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:49:23 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:49:24 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:49:24 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 63
2025-07-05 18:49:24 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 63
2025-07-05 18:49:24 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 92e3e923-87da-4505-aa42-e8f4b7710895
2025-07-05 18:49:41 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b
2025-07-05 18:49:41 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 64, 策略ID: 282, 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b
2025-07-05 18:49:41 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b
2025-07-05 18:49:41 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b
2025-07-05 18:49:41 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b
2025-07-05 18:49:41 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b, 状态码: 200
2025-07-05 18:49:41 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 64, 策略ID: 282
2025-07-05 18:49:41 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:49:41 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:49:41 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:49:54 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:49:54 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3533 字符
2025-07-05 18:49:54 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:49:54 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:49:57 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:49:57 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:49:57 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:50:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:50:24 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:50:24 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:50:24 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:50:24 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 63
2025-07-05 18:50:24 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 63
2025-07-05 18:50:24 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: fa5bad4e-5f3a-48d7-b0f5-b5483f428347
2025-07-05 18:50:37 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d
2025-07-05 18:50:37 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 65, 策略ID: 283, 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d
2025-07-05 18:50:37 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d
2025-07-05 18:50:37 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d
2025-07-05 18:50:37 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d
2025-07-05 18:50:37 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d, 状态码: 200
2025-07-05 18:50:37 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 65, 策略ID: 283
2025-07-05 18:50:37 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:50:38 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 18:50:38 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:51:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:51:03 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4361 字符
2025-07-05 18:51:03 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:51:03 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:51:06 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:51:06 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:51:06 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:51:24 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2
2025-07-05 18:51:24 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 66, 策略ID: 284, 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2
2025-07-05 18:51:24 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2
2025-07-05 18:51:24 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2
2025-07-05 18:51:24 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2
2025-07-05 18:51:24 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2, 状态码: 200
2025-07-05 18:51:24 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 66, 策略ID: 284
2025-07-05 18:51:24 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:51:24 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 1 条
2025-07-05 18:51:24 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:51:29 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:51:29 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2721 字符
2025-07-05 18:51:29 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:51:29 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:51:31 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:51:31 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:51:31 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:51:31 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:51:31 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:51:31 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:51:31 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:51:31 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 64
2025-07-05 18:51:31 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 64
2025-07-05 18:51:31 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: f0e53db6-35b4-461d-a1b7-324b28805e0b
2025-07-05 18:51:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:51:53 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:51:53 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:51:54 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:51:54 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 65
2025-07-05 18:51:54 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 65
2025-07-05 18:51:54 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 6421db8c-0b60-4649-9bd1-af059b0abb4d
2025-07-05 18:52:33 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:52:33 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3788 字符
2025-07-05 18:52:33 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:52:33 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:52:36 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:52:36 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:52:36 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:53:00 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:53:00 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:53:00 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:53:01 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:53:01 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 66
2025-07-05 18:53:01 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 66
2025-07-05 18:53:01 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: d3c3bd09-5e9d-41a0-954e-f08362907aa2
2025-07-05 18:56:20 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8
2025-07-05 18:56:20 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 67, 策略ID: 285, 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8
2025-07-05 18:56:20 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8
2025-07-05 18:56:20 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8
2025-07-05 18:56:20 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8
2025-07-05 18:56:20 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8, 状态码: 200
2025-07-05 18:56:20 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 67, 策略ID: 285
2025-07-05 18:56:20 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 18:56:21 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 1 条
2025-07-05 18:56:21 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 18:57:44 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:57:44 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4439 字符
2025-07-05 18:57:44 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 18:57:44 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 18:57:47 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:57:47 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 18:57:47 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 18:58:08 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 18:58:08 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 18:58:08 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 18:58:09 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 18:58:09 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 67
2025-07-05 18:58:09 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 67
2025-07-05 18:58:09 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: d7f567c8-93c4-4eb9-8b5c-a5997c1222f8
2025-07-05 19:01:25 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe
2025-07-05 19:01:25 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 68, 策略ID: 286, 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe
2025-07-05 19:01:25 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe
2025-07-05 19:01:25 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe
2025-07-05 19:01:25 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe
2025-07-05 19:01:25 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe, 状态码: 200
2025-07-05 19:01:25 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 68, 策略ID: 286
2025-07-05 19:01:25 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:01:25 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 0 条
2025-07-05 19:01:25 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:02:39 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:02:39 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3811 字符
2025-07-05 19:02:39 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:02:39 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:02:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:02:43 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:02:43 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:03:06 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:03:06 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:03:06 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:03:07 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 19:03:07 - utils - INFO - create_role:151 - 角色创建完成 - 租户ID: 1, 任务ID: 68
2025-07-05 19:03:07 - utils - INFO - create_role_background:164 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 68
2025-07-05 19:03:07 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 20d802c3-9d32-4cf2-a299-9fc0aec2bfbe
2025-07-05 19:03:11 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:03:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:03:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:03:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:03:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:03:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:03:16 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:03:16 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:11:41 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:11:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:11:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:11:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:11:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:11:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:11:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:11:47 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:12:13 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:12:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:12:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:12:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:12:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:12:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:12:19 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:12:19 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:15:25 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c
2025-07-05 19:15:25 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c
2025-07-05 19:15:25 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c
2025-07-05 19:15:25 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c
2025-07-05 19:15:25 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c
2025-07-05 19:15:25 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c, 状态码: 200
2025-07-05 19:15:25 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 19:15:25 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:15:26 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 19:15:26 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:16:19 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:16:19 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2994 字符
2025-07-05 19:16:19 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:16:19 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:16:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:16:21 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:16:21 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:16:41 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:16:41 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:16:41 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:16:42 - utils - ERROR - create_role:148 - 发送通知失败: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'strategy_id' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:16:43 - utils - ERROR - create_role:156 - 角色创建失败 - 租户ID: 123, 任务ID: str, 错误: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'strategy_id' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'strategy_id' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 149, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=3)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:16:43 - utils - ERROR - create_role_background:167 - 后台角色创建任务失败 - 租户ID: 123, 任务ID: str, 错误: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'strategy_id' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'strategy_id' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 164, in create_role_background
    await create_role(tenant_id, task_id, strategy_id)
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 149, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=3)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'strategy_id' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE strategy_id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:16:43 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: a462512b-41a1-49dc-ac7b-150d0d6c3d6c
2025-07-05 19:17:30 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:17:35 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:17:35 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:17:35 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:17:35 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:17:35 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:17:35 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:17:36 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:17:51 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80
2025-07-05 19:17:51 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80
2025-07-05 19:17:51 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80
2025-07-05 19:17:51 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80
2025-07-05 19:17:51 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80
2025-07-05 19:17:51 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80, 状态码: 200
2025-07-05 19:17:51 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 19:17:51 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:17:51 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 19:17:51 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:18:41 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:18:41 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2506 字符
2025-07-05 19:18:41 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:18:41 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:18:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:18:43 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:18:43 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:19:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:19:07 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:19:07 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:19:08 - utils - ERROR - create_role:148 - 发送通知失败: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:19:09 - utils - ERROR - create_role:156 - 角色创建失败 - 租户ID: 123, 任务ID: str, 错误: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 149, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=3)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:19:09 - utils - ERROR - create_role_background:167 - 后台角色创建任务失败 - 租户ID: 123, 任务ID: str, 错误: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 164, in create_role_background
    await create_role(tenant_id, task_id, strategy_id)
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 149, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=3)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:19:09 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: ffd5822f-aad4-4f4c-998e-2eb809b64d80
2025-07-05 19:19:45 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:19:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:19:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:19:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:19:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:19:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:19:50 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:19:50 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:20:00 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:20:05 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:05 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:05 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:05 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:05 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:05 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:05 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:20:07 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:20:12 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:12 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:12 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:12 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:12 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:12 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:12 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:20:17 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:20:58 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:58 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:58 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:58 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:58 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:58 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:20:58 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 19:20:58 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 19:20:58 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 19:20:58 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 19:20:58 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 19:21:03 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:21:03 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:21:03 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:21:03 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:21:03 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:21:03 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:21:04 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:22:54 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd
2025-07-05 19:22:54 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 123, 任务ID: str, 策略ID: 1324, 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd
2025-07-05 19:22:54 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd
2025-07-05 19:22:54 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd
2025-07-05 19:22:54 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd
2025-07-05 19:22:54 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd, 状态码: 200
2025-07-05 19:22:54 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 123, 任务ID: str, 策略ID: 1324
2025-07-05 19:22:54 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:22:54 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 766 条, 谈话风格: 237 条, 知识库: 690 条, 产品: 920 条
2025-07-05 19:22:54 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:23:44 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:23:44 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2633 字符
2025-07-05 19:23:44 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:23:44 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:23:46 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:23:46 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:23:46 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:24:15 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:24:15 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:24:15 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:24:16 - utils - ERROR - create_role:148 - 发送通知失败: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:24:17 - utils - ERROR - create_role:156 - 角色创建失败 - 租户ID: 123, 任务ID: str, 错误: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 149, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=3)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:24:17 - utils - ERROR - create_role_background:167 - 后台角色创建任务失败 - 租户ID: 123, 任务ID: str, 错误: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 145, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=2)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 2 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1054, "Unknown column 'str' in 'where clause'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 164, in create_role_background
    await create_role(tenant_id, task_id, strategy_id)
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 149, in create_role
    await send_prohibit_notify(tenant_id, task_id, strategy_id, prohibit_data, sale_flow_data, status=3)
  File "/home/funhpc/workspace/aisell_dev/tools/notify.py", line 157, in send_prohibit_notify
    db.execute_update(update_query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 144, in execute_update
    raise Exception(f"更新数据失败: {str(e)}")
Exception: 更新数据失败: (pymysql.err.OperationalError) (1054, "Unknown column 'str' in 'where clause'")
[SQL: 
    UPDATE sale_strategy SET status = 3 WHERE id = 1324 AND tenant_id = 123 AND task_id = str
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-05 19:24:17 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 5f5e509a-4470-4678-b6a2-2801ba28e6dd
2025-07-05 19:26:35 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e
2025-07-05 19:26:35 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 2, 策略ID: 30, 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e
2025-07-05 19:26:35 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e
2025-07-05 19:26:35 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e
2025-07-05 19:26:35 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e
2025-07-05 19:26:35 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 2, 策略ID: 30
2025-07-05 19:26:35 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e, 状态码: 200
2025-07-05 19:26:35 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:26:35 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 762 条, 谈话风格: 2 条, 知识库: 0 条, 产品: 0 条
2025-07-05 19:26:35 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:27:57 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:27:57 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4306 字符
2025-07-05 19:27:57 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:27:57 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:28:00 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:28:00 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:28:00 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:28:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:28:24 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:28:24 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:28:25 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 19:28:25 - utils - INFO - create_role:152 - 角色创建完成 - 租户ID: 1, 任务ID: 2
2025-07-05 19:28:25 - utils - INFO - create_role_background:165 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 2
2025-07-05 19:28:25 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 138cb89e-f299-4dc9-9b8d-f9228aba0e9e
2025-07-05 19:39:52 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: cbb6af53-1941-4073-a159-581596ced7f4
2025-07-05 19:39:52 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 2, 策略ID: 30, 请求ID: cbb6af53-1941-4073-a159-581596ced7f4
2025-07-05 19:39:52 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: cbb6af53-1941-4073-a159-581596ced7f4
2025-07-05 19:39:52 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: cbb6af53-1941-4073-a159-581596ced7f4
2025-07-05 19:39:52 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: cbb6af53-1941-4073-a159-581596ced7f4
2025-07-05 19:39:52 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 2, 策略ID: 30
2025-07-05 19:39:52 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: cbb6af53-1941-4073-a159-581596ced7f4, 状态码: 200
2025-07-05 19:39:52 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:39:52 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 762 条, 谈话风格: 2 条, 知识库: 0 条, 产品: 0 条
2025-07-05 19:39:52 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:41:11 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:41:11 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4246 字符
2025-07-05 19:41:11 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:41:11 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:41:18 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:41:18 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:41:18 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:41:40 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:41:40 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:41:40 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:41:41 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 19:41:41 - utils - INFO - create_role:152 - 角色创建完成 - 租户ID: 1, 任务ID: 2
2025-07-05 19:41:41 - utils - INFO - create_role_background:165 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 2
2025-07-05 19:41:41 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: cbb6af53-1941-4073-a159-581596ced7f4
2025-07-05 19:43:21 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 151256d7-a2a9-4d5e-b7b5-9a283eb61127
2025-07-05 19:43:21 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 2, 策略ID: 30, 请求ID: 151256d7-a2a9-4d5e-b7b5-9a283eb61127
2025-07-05 19:43:21 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 151256d7-a2a9-4d5e-b7b5-9a283eb61127
2025-07-05 19:43:21 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 151256d7-a2a9-4d5e-b7b5-9a283eb61127
2025-07-05 19:43:21 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 151256d7-a2a9-4d5e-b7b5-9a283eb61127
2025-07-05 19:43:21 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 151256d7-a2a9-4d5e-b7b5-9a283eb61127, 状态码: 200
2025-07-05 19:43:21 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 2, 策略ID: 30
2025-07-05 19:43:21 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:43:21 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 762 条, 谈话风格: 2 条, 知识库: 0 条, 产品: 0 条
2025-07-05 19:43:21 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:43:27 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:43:37 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:37 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:37 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:37 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:37 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:37 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:37 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 19:43:37 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 19:43:37 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 19:43:37 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 19:43:37 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 19:43:42 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:42 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:42 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:42 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:42 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:42 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:43:42 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:46:02 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457
2025-07-05 19:46:02 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457
2025-07-05 19:46:02 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457
2025-07-05 19:46:02 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457
2025-07-05 19:46:02 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457
2025-07-05 19:46:02 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457, 状态码: 200
2025-07-05 19:46:02 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 19:46:02 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:46:03 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 19:46:03 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:47:20 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:47:20 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 3993 字符
2025-07-05 19:47:20 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:47:20 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:47:23 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:47:23 - utils - INFO - extract_prohibit:38 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:47:23 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:47:50 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:47:50 - utils - INFO - extract_sale_flow:57 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 19:47:50 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:47:52 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 19:47:52 - utils - INFO - create_role:152 - 角色创建完成 - 租户ID: 1, 任务ID: 69
2025-07-05 19:47:52 - utils - INFO - create_role_background:165 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 19:47:52 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 52f29027-6c5f-4a39-9907-e96d9cac3457
2025-07-05 19:48:49 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:48:54 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:48:54 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:48:54 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:48:54 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:48:54 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:48:54 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:48:55 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:49:04 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a
2025-07-05 19:49:04 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a
2025-07-05 19:49:04 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a
2025-07-05 19:49:04 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a
2025-07-05 19:49:04 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a
2025-07-05 19:49:04 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a, 状态码: 200
2025-07-05 19:49:04 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 19:49:04 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:49:05 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 19:49:05 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:49:53 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:49:53 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 2868 字符
2025-07-05 19:49:53 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:49:53 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:49:53 - utils - ERROR - extract_prohibit:41 - 提取禁止事项失败: 'coroutine' object has no attribute 'strip'
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 37, in extract_prohibit
    response = await json.loads(chat_qwen(prompt).strip('```').strip('```json'))
                                ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'strip'
2025-07-05 19:49:53 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:49:53 - utils - ERROR - extract_sale_flow:60 - 提取销售流程失败: 'coroutine' object has no attribute 'strip'
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 56, in extract_sale_flow
    response = await json.loads(chat_qwen(prompt).strip('```').strip('```json'))
                                ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'strip'
2025-07-05 19:49:53 - utils - ERROR - create_role:134 - 禁止事项提取失败: 'coroutine' object has no attribute 'strip'
2025-07-05 19:49:53 - utils - ERROR - create_role:137 - 销售流程提取失败: 'coroutine' object has no attribute 'strip'
2025-07-05 19:49:53 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:49:54 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 19:49:54 - utils - INFO - create_role:152 - 角色创建完成 - 租户ID: 1, 任务ID: 69
2025-07-05 19:49:54 - utils - INFO - create_role_background:165 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 19:49:54 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: d8c661e0-350d-4506-904d-056aa1bcac4a
2025-07-05 19:56:37 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2
2025-07-05 19:56:37 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2
2025-07-05 19:56:37 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2
2025-07-05 19:56:37 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2
2025-07-05 19:56:37 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2
2025-07-05 19:56:37 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2, 状态码: 200
2025-07-05 19:56:37 - utils - INFO - create_role:74 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 19:56:37 - utils - INFO - create_role:78 - 正在并发获取所有数据...
2025-07-05 19:56:37 - utils - INFO - create_role:116 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 19:56:37 - utils - INFO - create_role:119 - 正在生成角色内容...
2025-07-05 19:58:06 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:58:06 - utils - INFO - create_role:121 - 角色内容生成完成，内容长度: 4487 字符
2025-07-05 19:58:06 - utils - INFO - create_role:124 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:58:06 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:58:06 - utils - ERROR - extract_prohibit:41 - 提取禁止事项失败: 'coroutine' object has no attribute 'strip'
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 37, in extract_prohibit
    response = await json.loads(chat_qwen(prompt).strip('```').strip('```json'))
                                ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'strip'
2025-07-05 19:58:06 - utils - INFO - extract_sale_flow:48 - 开始提取销售流程...
2025-07-05 19:58:06 - utils - ERROR - extract_sale_flow:60 - 提取销售流程失败: 'coroutine' object has no attribute 'strip'
Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/create_role.py", line 56, in extract_sale_flow
    response = await json.loads(chat_qwen(prompt).strip('```').strip('```json'))
                                ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'strip'
2025-07-05 19:58:06 - utils - ERROR - create_role:134 - 禁止事项提取失败: 'coroutine' object has no attribute 'strip'
2025-07-05 19:58:06 - utils - ERROR - create_role:137 - 销售流程提取失败: 'coroutine' object has no attribute 'strip'
2025-07-05 19:58:06 - utils - INFO - create_role:141 - 正在发送禁止事项和销售流程通知...
2025-07-05 19:58:06 - utils - INFO - create_role:146 - 通知发送成功
2025-07-05 19:58:06 - utils - INFO - create_role:152 - 角色创建完成 - 租户ID: 1, 任务ID: 69
2025-07-05 19:58:06 - utils - INFO - create_role_background:165 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 19:58:06 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: e4993829-b5b4-41ce-8190-06e7124bd2d2
2025-07-05 19:58:13 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 19:58:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:29 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:29 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 19:58:29 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 19:58:29 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 19:58:29 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 19:58:29 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 19:58:34 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:34 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:34 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:34 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:34 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:34 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 19:58:34 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 19:58:36 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8
2025-07-05 19:58:36 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8
2025-07-05 19:58:36 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8
2025-07-05 19:58:36 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8
2025-07-05 19:58:36 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8
2025-07-05 19:58:36 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8, 状态码: 200
2025-07-05 19:58:36 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 19:58:36 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 19:58:37 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 19:58:37 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 19:59:46 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:59:46 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 4080 字符
2025-07-05 19:59:46 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 19:59:46 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 19:59:48 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 19:59:48 - utils - INFO - extract_prohibit:39 - 禁止事项提取完成，提取到 未知数量 项
2025-07-05 19:59:48 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:00:13 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:00:13 - utils - INFO - extract_sale_flow:59 - 销售流程提取完成，提取到 未知数量 个流程
2025-07-05 20:00:13 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:00:14 - utils - INFO - create_role:148 - 通知发送成功
2025-07-05 20:00:14 - utils - INFO - create_role:154 - 角色创建完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:00:14 - utils - INFO - create_role_background:167 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:00:14 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 451e7387-2b47-46fe-8a30-4346f8a9b4a8
2025-07-05 20:00:49 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 20:00:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:00:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:00:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:00:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:00:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:00:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:00:55 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 20:01:00 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919
2025-07-05 20:01:00 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919
2025-07-05 20:01:00 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919
2025-07-05 20:01:00 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919
2025-07-05 20:01:00 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919
2025-07-05 20:01:00 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919, 状态码: 200
2025-07-05 20:01:00 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:01:00 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 20:01:01 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 20:01:01 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 20:02:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:02:07 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 3544 字符
2025-07-05 20:02:07 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 20:02:07 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 20:02:09 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:02:09 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:02:31 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:02:31 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:02:31 - utils - INFO - create_role:147 - 有5个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户', '禁止不符合行业规范和法律法规的行为']
2025-07-05 20:02:31 - utils - INFO - create_role:148 - 有4个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例: 您好，我是[公司名称]的[您的名字]，我司在[您的研究方向，例如：AI分布式推理框架]领域有领先的技术和方案，看到您在[客户相关领域]的洞察非常深刻，想了解一下您目前在AI模型部署方面是否有遇到挑战？或许我们的[产品名称]能为您带来新的思路。', '强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例: 感谢您的分享，了解到您在[客户痛点，例如：AI模型推理效率]方面有提升需求。我们[产品名称]的[产品某功能，例如：自适应负载均衡技术]正是为了解决这类问题而设计，能够有效提升[提升点]，降低[降低点]。我们曾帮助[某类似企业]实现了[具体成效]。', '倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '话术示例: 听下来，您的核心诉求是[总结客户需求]，而我们的[产品名称]正是在[产品核心价值]上具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的[技术深度/定制能力]，更无法充分了解您的具体应用场景。不如我们约个时间，我带上我们的技术专家，当面给您做一个[产品演示/方案介绍]，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？', '强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '话术示例: 太好了！那就定在[日期]的[时间]在[地点]。为了能更高效地交流，您看您那边是否能提前准备一下目前AI部署的[相关挑战/技术需求]，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '细致周到，展现专业。']}]
2025-07-05 20:02:33 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 20:02:33 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:02:33 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:02:33 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 852bd885-14f1-49cd-bdde-64feada0b919
2025-07-05 20:08:10 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4
2025-07-05 20:08:10 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 71, 策略ID: 288, 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4
2025-07-05 20:08:10 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4
2025-07-05 20:08:10 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4
2025-07-05 20:08:10 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4
2025-07-05 20:08:10 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 71, 策略ID: 288
2025-07-05 20:08:10 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4, 状态码: 200
2025-07-05 20:08:10 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 20:08:10 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 2 条, 产品: 2 条
2025-07-05 20:08:10 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 20:09:25 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:09:25 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 4515 字符
2025-07-05 20:09:25 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 20:09:25 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 20:09:29 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:09:29 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:10:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:10:03 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:10:03 - utils - INFO - create_role:147 - 有5个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式（如“我正在学习您的需求”、“我会不断优化自己”等）', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户（如频繁发送无关信息、深夜联系）', '禁止不符合行业规范和法律法规的行为（如虚假宣传、侵犯隐私）']
2025-07-05 20:10:03 - utils - INFO - create_role:148 - 有5个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['目标: 引起客户关注，初步了解客户背景。', '行动: 通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例: 您好，我是[公司名称]的[您的名字]，我司在[您的研究方向，例如：AI分布式推理框架]领域有领先的技术和方案，看到您在[客户相关领域]的洞察非常深刻，想了解一下您目前在AI模型部署方面是否有遇到挑战？或许我们的[产品名称]能为您带来新的思路。', '关键: 强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['目标: 深入了解客户具体需求和痛点，匹配产品解决方案。', '行动: 引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例: 感谢您的分享，了解到您在[客户痛点，例如：AI模型推理效率]方面有提升需求。我们[产品名称]的[产品某功能，例如：自适应负载均衡技术]正是为了解决这类问题而设计，能够有效提升[提升点]，降低[降低点]。我们曾帮助[某类似企业]实现了[具体成效]。', '关键: 倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['目标: 建立专业可信形象，提出线下见面邀约。', "行动: 总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '话术示例: 听下来，您的核心诉求是[总结客户需求]，而我们的[产品名称]正是在[产品核心价值]上具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的[技术深度/定制能力]，更无法充分了解您的具体应用场景。不如我们约个时间，我带上我们的技术专家，当面给您做一个[产品演示/方案介绍]，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？', '关键: 强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['目标: 确认见面细节，为线下见面做充分准备。', '行动: 一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '话术示例: 太好了！那就定在[日期]的[时间]在[地点]。为了能更高效地交流，您看您那边是否能提前准备一下目前AI部署的[相关挑战/技术需求]，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '关键: 细致周到，展现专业。']}, {'title': '后续跟进与转化推动', 'description': ['目标: 回访见面成果，推动客户做出决策。', '行动: 见面后24小时内发送感谢信息，并附上会议纪要、推荐方案、联系方式。根据客户反馈，制定下一步推进计划。', '话术示例: 李总，非常感谢今天您的宝贵时间！根据我们的交流，我已将初步方案整理成文档，请您查收。如果您有任何疑问，欢迎随时联系我。期待我们有机会合作，共同推进AI在贵司的应用落地。', '关键: 快速响应、强化信任、推动签约']}]
2025-07-05 20:10:04 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 20:10:04 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 71
2025-07-05 20:10:04 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 71
2025-07-05 20:10:04 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: 36db2418-9dc0-4e0e-9ec5-b7ff76e69ea4
2025-07-05 20:14:05 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 20:14:11 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:14:11 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:14:11 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:14:11 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:14:11 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:14:11 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:14:11 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 20:37:02 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148
2025-07-05 20:37:02 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148
2025-07-05 20:37:02 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148
2025-07-05 20:37:02 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148
2025-07-05 20:37:02 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148
2025-07-05 20:37:02 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148, 状态码: 200
2025-07-05 20:37:02 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:37:02 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 20:37:02 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 20:37:02 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 20:38:03 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:38:03 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 3137 字符
2025-07-05 20:38:03 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 20:38:03 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 20:38:06 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:38:06 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:38:31 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:38:31 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:38:31 - utils - INFO - create_role:147 - 有5个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户', '禁止不符合行业规范和法律法规的行为']
2025-07-05 20:38:31 - utils - INFO - create_role:148 - 有4个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['目标: 引起客户关注，初步了解客户背景。', '行动: 通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例: 您好，我是‘一路绿灯’的AI解决方案顾问张伟。我们专注AI软件定制开发，近期帮助多家制造企业实现了生产流程智能化升级。了解到贵司也在探索AI应用，不知道您这边是否有过尝试？', '关键: 强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['目标: 深入了解客户具体需求和痛点，匹配产品解决方案。', '行动: 引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例: 感谢您的分享，了解到您在AI质检准确率方面有提升需求。我们最近刚为一家汽车零部件厂商完成了类似的项目，他们的质检误判率从8%降至0.5%，您有兴趣了解一下我们的实现方式吗？', '关键: 倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['目标: 建立专业可信形象，提出线下见面邀约。', "行动: 总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '话术示例: 听下来，您的核心诉求是提升质检效率和减少人工复检，而我们的AI质检系统正是在这方面具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的技术细节和实施效果，不如我们约个时间，我带上我们的技术专家，当面给您做一个完整方案介绍，您看本周四下午或下周二上午方便吗？', '关键: 强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['目标: 确认见面细节，为线下见面做充分准备。', '行动: 一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '话术示例: 太好了！那就定在下周二的上午10点在贵司会议室。为了能更高效地交流，您看您那边是否能提前准备一下目前质检流程的现状数据和目标指标，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '关键: 细致周到，展现专业。']}]
2025-07-05 20:38:33 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 20:38:33 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:38:33 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:38:33 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: e4cad0fc-9742-4efb-8cd2-f09b9b8a8148
2025-07-05 20:39:00 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 20:39:06 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:39:06 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:39:06 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:39:06 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:39:06 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:39:06 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:39:06 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 20:39:06 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0
2025-07-05 20:39:06 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0
2025-07-05 20:39:06 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0
2025-07-05 20:39:06 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0
2025-07-05 20:39:06 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0
2025-07-05 20:39:06 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0, 状态码: 200
2025-07-05 20:39:06 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:39:06 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 20:39:06 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 20:39:06 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 20:40:17 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:40:17 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 3691 字符
2025-07-05 20:40:17 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 20:40:17 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 20:40:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:40:21 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:40:39 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:40:39 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:40:39 - utils - INFO - create_role:147 - 有8个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户', '禁止不符合行业规范和法律法规的行为', '禁止使用模糊不清、夸大其词或误导性话术', '禁止未经客户同意擅自转发客户信息', '禁止在未明确授权的情况下代表公司承诺任何事项']
2025-07-05 20:40:39 - utils - INFO - create_role:148 - 有4个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', "话术示例: '您好，我是‘一路绿灯AI’的李晨，我们专注于为企业提供AI软件定制服务。看到您在智能制造领域非常活跃，想请教一下您目前在AI质检方面是否有尝试过新技术？'", '强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', "话术示例: '感谢您的分享，了解到您在质检效率方面有提升需求。我们推出的AI质检系统支持多源图像输入，能够自动识别超过20种缺陷类型，准确率达到99.2%，已帮助某头部汽车厂商节省了70%的人工复检成本。'", '倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", "话术示例: '听下来，您的核心诉求是希望提升质检准确率和效率，而我们的AI质检系统正是在这方面具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们的技术深度，更无法充分了解您的具体产线情况。不如我们约个时间，我带上我们的技术专家，当面给您做一个演示，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？'", '强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', "话术示例: '太好了！那就定在下周三的上午10点，在贵司会议室。为了能更高效地交流，您看您那边是否能提前准备一下目前质检流程和系统架构图？这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。'", '细致周到，展现专业。']}]
2025-07-05 20:40:40 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '初步接触与兴趣激发',
            '['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', "话术示例: '您好，我是‘一路绿灯AI’的李晨，我们专注于为企业提供AI软件定制服务。看到您在智能制造领域非常活跃，想请教一下您目前在AI质检方面是否有尝试过新技术？'", '强调专业性，引出客户潜在痛点。']',
            '0',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:40:40 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '需求挖掘与价值匹配',
            '['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', "话术示例: '感谢您的分享，了解到您在质检效率方面有提升需求。我们推出的AI质检系统支持多源图像输入，能够自动识别超过20种缺陷类型，准确率达到99.2%，已帮助某头部汽车厂商节省了70%的人工复检成本。'", '倾听、理解、定制化。']',
            '1',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:40:40 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '专业展示与线下邀约',
            '['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", "话术示例: '听下来，您的核心诉求是希望提升质检准确率和效率，而我们的AI质检系统正是在这方面具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们的技术深度，更无法充分了解您的具体产线情况。不如我们约个时间，我带上我们的技术专家，当面给您做一个演示，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？'", '强化见面价值，提供便利选择。']',
            '2',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:40:40 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '确认与准备',
            '['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', "话术示例: '太好了！那就定在下周三的上午10点，在贵司会议室。为了能更高效地交流，您看您那边是否能提前准备一下目前质检流程和系统架构图？这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。'", '细致周到，展现专业。']',
            '3',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:40:40 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 20:40:40 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:40:40 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:40:40 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: eb8ceee5-5591-4b62-9340-43800571a6f0
2025-07-05 20:42:26 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 20:42:31 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:42:31 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:42:31 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:42:31 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:42:31 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:42:31 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 20:42:32 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 20:42:34 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f
2025-07-05 20:42:34 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 69, 策略ID: 287, 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f
2025-07-05 20:42:34 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f
2025-07-05 20:42:34 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f
2025-07-05 20:42:34 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f
2025-07-05 20:42:34 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f, 状态码: 200
2025-07-05 20:42:34 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:42:34 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 20:42:34 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 3 条, 产品: 4 条
2025-07-05 20:42:34 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 20:43:55 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:43:55 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 4480 字符
2025-07-05 20:43:55 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 20:43:55 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 20:44:00 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:44:00 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:44:24 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:44:24 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:44:24 - utils - INFO - create_role:147 - 有8个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式（如“根据我的数据模型分析…”）', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户', '禁止不符合行业规范和法律法规的行为', '禁止使用模板化、机械化的回复语句', '禁止在未征得客户同意的情况下频繁更换沟通方式（如突然电话联系）', '禁止未经核实随意承诺客户任何技术指标或交付时间']
2025-07-05 20:44:24 - utils - INFO - create_role:148 - 有5个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '您好，我是[公司名称]的[您的名字]，我们专注为制造业企业提供AI质检解决方案。看到您公司在智能制造领域也有布局，或许我们近期刚帮一家同行实现质检效率提升90%的方案也能为您带来参考。', '强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '感谢您的分享，了解到您在[客户痛点，例如：质检误判率高]方面有改进需求。我们[产品名称]的[产品某功能，例如：自适应图像识别算法]正是为了解决这类问题而设计，能够有效提升[提升点]，降低[降低点]。我们曾帮助[某类似企业]实现了[具体成效]。', '倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '听下来，您的核心诉求是[总结客户需求]，而我们的[产品名称]正是在[产品核心价值]上具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的[技术深度/定制能力]，更无法充分了解您的具体应用场景。不如我们约个时间，我带上我们的技术专家，当面给您做一个[产品演示/方案介绍]，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？', '强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '太好了！那就定在[日期]的[时间]在[地点]。为了能更高效地交流，您看您那边是否能提前准备一下目前AI部署的[相关挑战/技术需求]，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '细致周到，展现专业。']}, {'title': '后续跟进与转化', 'description': ['通过会后跟进强化客户印象，推动后续合作。', '发送会议纪要、方案文档、报价单等材料，持续关注客户反馈，解答疑问，推动签约。', '上次拜访非常愉快，也非常感谢您的坦诚交流。这是我们整理的定制化AI质检方案，请您查阅。如有任何修改意见或补充需求，欢迎随时联系我。期待能有机会进一步合作，助力贵司智能化升级。', '快速响应，持续跟进。']}]
2025-07-05 20:44:26 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '初步接触与兴趣激发',
            "['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '您好，我是[公司名称]的[您的名字]，我们专注为制造业企业提供AI质检解决方案。看到您公司在智能制造领域也有布局，或许我们近期刚帮一家同行实现质检效率提升90%的方案也能为您带来参考。', '强调专业性，引出客户潜在痛点。']",
            '0',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:44:26 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '需求挖掘与价值匹配',
            "['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '感谢您的分享，了解到您在[客户痛点，例如：质检误判率高]方面有改进需求。我们[产品名称]的[产品某功能，例如：自适应图像识别算法]正是为了解决这类问题而设计，能够有效提升[提升点]，降低[降低点]。我们曾帮助[某类似企业]实现了[具体成效]。', '倾听、理解、定制化。']",
            '1',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:44:26 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '专业展示与线下邀约',
            "['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '听下来，您的核心诉求是[总结客户需求]，而我们的[产品名称]正是在[产品核心价值]上具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的[技术深度/定制能力]，更无法充分了解您的具体应用场景。不如我们约个时间，我带上我们的技术专家，当面给您做一个[产品演示/方案介绍]，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？', '强化见面价值，提供便利选择。']",
            '2',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:44:26 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '确认与准备',
            "['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '太好了！那就定在[日期]的[时间]在[地点]。为了能更高效地交流，您看您那边是否能提前准备一下目前AI部署的[相关挑战/技术需求]，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '细致周到，展现专业。']",
            '3',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:44:26 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '287',
            '后续跟进与转化',
            "['通过会后跟进强化客户印象，推动后续合作。', '发送会议纪要、方案文档、报价单等材料，持续关注客户反馈，解答疑问，推动签约。', '上次拜访非常愉快，也非常感谢您的坦诚交流。这是我们整理的定制化AI质检方案，请您查阅。如有任何修改意见或补充需求，欢迎随时联系我。期待能有机会进一步合作，助力贵司智能化升级。', '快速响应，持续跟进。']",
            '4',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:44:26 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 20:44:26 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 69, 策略ID: 287
2025-07-05 20:44:26 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 69
2025-07-05 20:44:26 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: bfc61c51-3e07-4042-a0ca-8469dce0023f
2025-07-05 20:45:38 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95
2025-07-05 20:45:38 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 73, 策略ID: 290, 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95
2025-07-05 20:45:38 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95
2025-07-05 20:45:38 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95
2025-07-05 20:45:38 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95
2025-07-05 20:45:38 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95, 状态码: 200
2025-07-05 20:45:38 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 73, 策略ID: 290
2025-07-05 20:45:38 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 20:45:38 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 2 条, 产品: 1 条
2025-07-05 20:45:38 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 20:46:46 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:46:46 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 3749 字符
2025-07-05 20:46:46 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 20:46:46 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 20:46:50 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:46:50 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 20:47:12 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 20:47:12 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 20:47:12 - utils - INFO - create_role:147 - 有8个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户', '禁止不符合行业规范和法律法规的行为', '禁止承诺超出产品能力范围的内容', '禁止未经客户同意擅自转发其联系方式或信息', '禁止在微信中发送无关链接、广告、红包等诱导性内容']
2025-07-05 20:47:12 - utils - INFO - create_role:148 - 有4个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例：您好，我是来自一路绿灯的李明，我们专注于用AI提升销售团队的客户转化效率。看到您也在做销售管理相关的工作，想请教一下目前是否遇到客户线索少、跟进难的问题？或许我们的‘AI销售’产品能为您提供新思路。', '关键：强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例：感谢您的分享，了解到您在客户跟进效率方面有提升需求。我们的‘AI销售’产品具备自动筛选高意向客户并完成初步沟通的能力，曾帮助某电商客户提升了60%的转化率。', '关键：倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '话术示例：听下来，您的核心诉求是提升客户跟进效率，而我们的‘AI销售’正是在自动化客户筛选与初步沟通上具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的深度服务能力。不如我们约个时间，我带上我们的产品负责人，当面给您做一个演示，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？', '关键：强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '话术示例：太好了！那就定在下周二下午三点，在您公司会议室。为了能更高效地交流，您看是否能提前准备一下您目前使用的CRM系统截图或客户分类标准，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '关键：细致周到，展现专业。']}]
2025-07-05 20:47:13 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '290',
            '初步接触与兴趣激发',
            "['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例：您好，我是来自一路绿灯的李明，我们专注于用AI提升销售团队的客户转化效率。看到您也在做销售管理相关的工作，想请教一下目前是否遇到客户线索少、跟进难的问题？或许我们的‘AI销售’产品能为您提供新思路。', '关键：强调专业性，引出客户潜在痛点。']",
            '0',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:47:13 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '290',
            '需求挖掘与价值匹配',
            "['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有AI部署情况、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例：感谢您的分享，了解到您在客户跟进效率方面有提升需求。我们的‘AI销售’产品具备自动筛选高意向客户并完成初步沟通的能力，曾帮助某电商客户提升了60%的转化率。', '关键：倾听、理解、定制化。']",
            '1',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:47:13 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '290',
            '专业展示与线下邀约',
            "['建立专业可信形象，提出线下见面邀约。', "总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出'线上沟通不如线下详谈'的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。", '话术示例：听下来，您的核心诉求是提升客户跟进效率，而我们的‘AI销售’正是在自动化客户筛选与初步沟通上具备独特优势。我觉得仅仅通过文字交流，很难全面展示我们产品的深度服务能力。不如我们约个时间，我带上我们的产品负责人，当面给您做一个演示，详细探讨一下如何为您量身定制解决方案，您看本周二下午或周四上午方便吗？', '关键：强化见面价值，提供便利选择。']",
            '2',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:47:14 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '290',
            '确认与准备',
            "['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前系统架构、具体需求清单等）。发送会议邀请。', '话术示例：太好了！那就定在下周二下午三点，在您公司会议室。为了能更高效地交流，您看是否能提前准备一下您目前使用的CRM系统截图或客户分类标准，这样我们能更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '关键：细致周到，展现专业。']",
            '3',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 20:47:14 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 20:47:14 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 73, 策略ID: 290
2025-07-05 20:47:14 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 73
2025-07-05 20:47:14 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: d4fc06c8-e454-4110-9da4-09f0c7363d95
2025-07-05 21:05:55 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: f5965c46-6aa3-4af7-8ece-6227107cb9e8
2025-07-05 21:05:55 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 75, 策略ID: 291, 请求ID: f5965c46-6aa3-4af7-8ece-6227107cb9e8
2025-07-05 21:05:55 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: f5965c46-6aa3-4af7-8ece-6227107cb9e8
2025-07-05 21:05:55 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: f5965c46-6aa3-4af7-8ece-6227107cb9e8
2025-07-05 21:05:55 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: f5965c46-6aa3-4af7-8ece-6227107cb9e8
2025-07-05 21:05:55 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 75, 策略ID: 291
2025-07-05 21:05:55 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 21:05:55 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: f5965c46-6aa3-4af7-8ece-6227107cb9e8, 状态码: 200
2025-07-05 21:18:45 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 21:18:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:18:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:18:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:18:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:18:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:18:55 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:18:56 - api - INFO - <module>:27 - 启动角色创建服务...
2025-07-05 21:18:56 - api - INFO - <module>:28 - 服务地址: http://0.0.0.0:11435
2025-07-05 21:18:56 - api - INFO - <module>:29 - 自动重载: True
2025-07-05 21:18:56 - api - INFO - <module>:30 - API文档: http://0.0.0.0:11435/docs
2025-07-05 21:18:56 - api - INFO - <module>:31 - 健康检查: http://0.0.0.0:11435/health
2025-07-05 21:19:01 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:19:01 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:19:01 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:19:01 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:19:01 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:19:01 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:19:01 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 21:39:42 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 21:39:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:39:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:39:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:39:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:39:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:39:47 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:39:47 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 21:40:08 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 21:40:13 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:40:13 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:40:13 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:40:13 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:40:13 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:40:13 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:40:13 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 21:41:09 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 21:41:14 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:41:14 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:41:14 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:41:14 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:41:14 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:41:14 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 21:41:14 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 21:57:30 - api - INFO - add_request_id:21 - 收到请求: POST /create_role, 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2
2025-07-05 21:57:30 - api - INFO - create_role_api:73 - 开始处理角色创建请求 - 租户ID: 1, 任务ID: 41, 策略ID: 28, 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2
2025-07-05 21:57:30 - api - INFO - create_role_api:83 - 立即返回响应，启动后台线程处理角色创建 - 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2
2025-07-05 21:57:30 - api - INFO - process_role_creation_background:50 - 开始后台处理角色创建任务 - 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2
2025-07-05 21:57:30 - api - INFO - create_role_api:93 - 角色创建任务已提交到后台线程 - 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2
2025-07-05 21:57:30 - api - INFO - add_request_id:23 - 请求处理完成: POST /create_role, 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2, 状态码: 200
2025-07-05 21:57:30 - utils - INFO - create_role:76 - 开始创建角色 - 租户ID: 1, 任务ID: 41, 策略ID: 28
2025-07-05 21:57:30 - utils - INFO - create_role:80 - 正在并发获取所有数据...
2025-07-05 21:57:32 - utils - INFO - create_role:118 - 数据获取完成 - 基础信息: 763 条, 谈话风格: 1 条, 知识库: 1 条, 产品: 2 条
2025-07-05 21:57:32 - utils - INFO - create_role:121 - 正在生成角色内容...
2025-07-05 21:58:50 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 21:58:50 - utils - INFO - create_role:123 - 角色内容生成完成，内容长度: 3930 字符
2025-07-05 21:58:50 - utils - INFO - create_role:126 - 正在并发提取禁止事项和销售流程...
2025-07-05 21:58:50 - utils - INFO - extract_prohibit:29 - 开始提取禁止事项...
2025-07-05 21:58:52 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 21:58:52 - utils - INFO - extract_sale_flow:49 - 开始提取销售流程...
2025-07-05 21:59:13 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-05 21:59:13 - utils - INFO - create_role:143 - 正在发送禁止事项和销售流程通知...
2025-07-05 21:59:13 - utils - INFO - create_role:147 - 有5个禁止事项，禁止事项内容为：['禁止提及自己是AI或机器人', '禁止使用AI特有的表达方式', '禁止在任何情况下透露AI身份', '禁止过度推销或骚扰客户', '禁止不符合行业规范和法律法规的行为']
2025-07-05 21:59:13 - utils - INFO - create_role:148 - 有4个销售流程，销售流程内容为：[{'title': '初步接触与兴趣激发', 'description': ['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例: 您好张总，我是‘一路绿灯’的AI销售顾问小林，我们专注用AI提升销售效率。看到您最近在朋友圈提到销售漏斗优化的问题，正好这是我们特别擅长的方向，能否简单聊几句？', '强调专业性，引出客户潜在痛点。']}, {'title': '需求挖掘与价值匹配', 'description': ['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有销售流程、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例: 您这边销售团队大概有多少人？目前主要靠什么方式获取客户线索？如果AI能自动筛选高意向客户并提前打好标签，您觉得这对你们的转化效率会有帮助吗？', '倾听、理解、定制化。']}, {'title': '专业展示与线下邀约', 'description': ['建立专业可信形象，提出线下见面邀约。', '总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出“线上沟通不如线下详谈”的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。', '话术示例: 听下来，您的核心诉求是提高销售线索转化率，而我们的AI销售系统正好在这方面积累了丰富的实战经验。我觉得仅仅通过文字交流很难全面展示它的潜力，不如我们约个时间，我带上我们的产品经理，给您做一个详细演示，您看周二下午或周四上午哪个更方便？', '强化见面价值，提供便利选择。']}, {'title': '确认与准备', 'description': ['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前销售流程、客户来源渠道等）。发送会议邀请。', '话术示例: 太好了！那就定在[日期]的[时间]在[地点]。为了能更高效地交流，您看您那边是否能提前准备一下目前销售流程的关键节点和难点，这样我们可以更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '细致周到，展现专业。']}]
2025-07-05 21:59:14 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '28',
            '初步接触与兴趣激发',
            "['引起客户关注，初步了解客户背景。', '通过微信添加客户（注明来源），发送个性化开场白，介绍公司和产品核心价值（不超过三句话）。', '话术示例: 您好张总，我是‘一路绿灯’的AI销售顾问小林，我们专注用AI提升销售效率。看到您最近在朋友圈提到销售漏斗优化的问题，正好这是我们特别擅长的方向，能否简单聊几句？', '强调专业性，引出客户潜在痛点。']",
            '0',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 21:59:14 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '28',
            '需求挖掘与价值匹配',
            "['深入了解客户具体需求和痛点，匹配产品解决方案。', '引导客户进行简短对话，通过提问了解其现有销售流程、面临的挑战、期望达成的目标。针对性地介绍产品功能如何解决其痛点，并简要提及成功案例。', '话术示例: 您这边销售团队大概有多少人？目前主要靠什么方式获取客户线索？如果AI能自动筛选高意向客户并提前打好标签，您觉得这对你们的转化效率会有帮助吗？', '倾听、理解、定制化。']",
            '1',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 21:59:14 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '28',
            '专业展示与线下邀约',
            "['建立专业可信形象，提出线下见面邀约。', '总结客户需求，强调产品能带来的具体收益。基于客户兴趣点，提出“线上沟通不如线下详谈”的理念，邀约客户线下见面进行更深入的演示或探讨。可提供多轮时间选项。', '话术示例: 听下来，您的核心诉求是提高销售线索转化率，而我们的AI销售系统正好在这方面积累了丰富的实战经验。我觉得仅仅通过文字交流很难全面展示它的潜力，不如我们约个时间，我带上我们的产品经理，给您做一个详细演示，您看周二下午或周四上午哪个更方便？', '强化见面价值，提供便利选择。']",
            '2',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 21:59:14 - utils - INFO - send_prohibit_notify:157 - 插入销售流程: 
        INSERT INTO sale_process (
            strategy_id,
            title,
            text,
            sort,
            tenant_id,
            create_by,
            create_time,
            is_del
        ) VALUES (
            '28',
            '确认与准备',
            "['确认见面细节，为线下见面做充分准备。', '一旦客户同意，立即确认具体时间、地点，并简要告知见面流程和需要客户准备的信息（如：当前销售流程、客户来源渠道等）。发送会议邀请。', '话术示例: 太好了！那就定在[日期]的[时间]在[地点]。为了能更高效地交流，您看您那边是否能提前准备一下目前销售流程的关键节点和难点，这样我们可以更有针对性地进行讨论。我也会准备好针对您业务场景的定制化方案初稿。', '细致周到，展现专业。']",
            '3',
            '1',
            'admin',
            NOW(),
            0
        );

        
2025-07-05 21:59:14 - utils - INFO - create_role:150 - 通知发送成功
2025-07-05 21:59:14 - utils - INFO - create_role:156 - 角色创建完成 - 租户ID: 1, 任务ID: 41, 策略ID: 28
2025-07-05 21:59:14 - utils - INFO - create_role_background:169 - 后台角色创建任务完成 - 租户ID: 1, 任务ID: 41
2025-07-05 21:59:14 - api - INFO - process_role_creation_background:59 - 角色创建任务执行完成 - 请求ID: d01105a3-ee47-492d-b607-4756ebe2e6f2
2025-07-05 23:24:21 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 23:24:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:24:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:24:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:24:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:24:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:24:26 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:24:26 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 23:27:52 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 23:27:57 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:27:57 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:27:57 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:27:57 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:27:57 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:27:57 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:27:57 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-05 23:30:03 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-05 23:30:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:30:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:30:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:30:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for gemini-.* from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:30:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/endpoints\/.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:30:08 - google_adk.google.adk.models.registry - INFO - _register:64 - Updating LLM class for projects\/.+\/locations\/.+\/publishers\/google\/models\/gemini.+ from <class 'google.adk.models.google_llm.Gemini'> to <class 'google.adk.models.google_llm.Gemini'>
2025-07-05 23:30:09 - api - INFO - startup_event:135 - 角色创建服务启动完成
2025-07-06 00:09:00 - api - INFO - shutdown_event:140 - 角色创建服务正在关闭
2025-07-06 10:18:06 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=171 状态失败：更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 171
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 806, in _write_bytes
    self._sock.sendall(data)
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 171
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 171
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-06 10:18:07 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp247etwcq.jpeg
2025-07-06 10:18:07 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp247etwcq.jpeg
2025-07-06 10:18:07 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp247etwcq.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-06 10:18:07 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp247etwcq.jpeg' 的MIME类型为: image/jpeg
2025-07-06 10:18:07 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp247etwcq.jpeg
2025-07-06 10:18:10 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 10:18:10 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 74 字符。
2025-07-06 10:18:13 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=171 的状态为 2
2025-07-06 10:18:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 1
2025-07-06 10:18:36 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpy7tooy5i.docx
2025-07-06 10:18:36 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpy7tooy5i.docx
2025-07-06 10:18:36 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 3 个原始段落。
2025-07-06 10:18:36 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpy7tooy5i.docx
2025-07-06 10:18:36 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 201
2025-07-06 10:18:36 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 10:18:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 10:18:43 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 527
2025-07-06 10:18:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 2
2025-07-06 13:41:41 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=175 状态失败：更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 175
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 806, in _write_bytes
    self._sock.sendall(data)
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 175
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 175
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-06 13:41:42 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp6rwc2yvb.docx
2025-07-06 13:41:42 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp6rwc2yvb.docx
2025-07-06 13:41:42 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 3 个原始段落。
2025-07-06 13:41:42 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp6rwc2yvb.docx
2025-07-06 13:41:42 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 201
2025-07-06 13:41:42 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 13:41:46 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 1
2025-07-06 13:41:46 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpgyfmxows.docx
2025-07-06 13:41:46 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpgyfmxows.docx
2025-07-06 13:41:46 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 3 个原始段落。
2025-07-06 13:41:46 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpgyfmxows.docx
2025-07-06 13:41:46 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 201
2025-07-06 13:41:46 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 13:41:52 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 13:41:52 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 668
2025-07-06 13:41:53 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 2
2025-07-06 13:41:53 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 1
2025-07-06 13:41:53 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpiipg92e_.jpeg
2025-07-06 13:41:53 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpiipg92e_.jpeg
2025-07-06 13:41:53 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpiipg92e_.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-06 13:41:53 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpiipg92e_.jpeg' 的MIME类型为: image/jpeg
2025-07-06 13:41:53 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpiipg92e_.jpeg
2025-07-06 13:41:55 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 13:41:55 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 557
2025-07-06 13:41:55 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 2
2025-07-06 13:41:57 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 13:41:57 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 83 字符。
2025-07-06 13:41:57 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 2
2025-07-06 13:45:49 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 1
2025-07-06 13:45:49 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpe_fmcwxs.docx
2025-07-06 13:45:49 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpe_fmcwxs.docx
2025-07-06 13:45:49 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 3 个原始段落。
2025-07-06 13:45:49 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpe_fmcwxs.docx
2025-07-06 13:45:49 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 201
2025-07-06 13:45:49 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 13:45:59 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 13:45:59 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 603
2025-07-06 13:45:59 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 2
2025-07-06 14:01:36 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 1
2025-07-06 14:01:36 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpueu2d060.jpeg
2025-07-06 14:01:36 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpueu2d060.jpeg
2025-07-06 14:01:36 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpueu2d060.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-06 14:01:36 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpueu2d060.jpeg' 的MIME类型为: image/jpeg
2025-07-06 14:01:36 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpueu2d060.jpeg
2025-07-06 14:01:39 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 14:01:39 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 85 字符。
2025-07-06 14:01:39 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=163 的状态为 2
2025-07-06 15:51:49 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=177 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-06 15:51:49 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpl5baplv9.docx
2025-07-06 15:51:49 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpl5baplv9.docx
2025-07-06 15:51:49 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-06 15:51:49 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpl5baplv9.docx
2025-07-06 15:51:49 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-06 15:51:49 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 15:52:15 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 15:52:15 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1657
2025-07-06 15:52:15 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 2
2025-07-06 18:58:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 1
2025-07-06 18:58:16 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpw71hrqb6.docx
2025-07-06 18:58:16 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpw71hrqb6.docx
2025-07-06 18:58:16 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-06 18:58:16 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpw71hrqb6.docx
2025-07-06 18:58:16 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-06 18:58:16 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 18:58:20 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=172 状态失败：更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 172
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 806, in _write_bytes
    self._sock.sendall(data)
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 172
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 172
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-06 18:58:20 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp8ikxsffe.jpeg
2025-07-06 18:58:20 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp8ikxsffe.jpeg
2025-07-06 18:58:20 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp8ikxsffe.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-06 18:58:20 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp8ikxsffe.jpeg' 的MIME类型为: image/jpeg
2025-07-06 18:58:20 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp8ikxsffe.jpeg
2025-07-06 18:58:23 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 18:58:23 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 61 字符。
2025-07-06 18:58:24 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 2
2025-07-06 18:58:40 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 18:58:40 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1763
2025-07-06 18:58:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-06 18:58:41 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 1
2025-07-06 18:58:41 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmperookn1y.jpeg
2025-07-06 18:58:41 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmperookn1y.jpeg
2025-07-06 18:58:41 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmperookn1y.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-06 18:58:41 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmperookn1y.jpeg' 的MIME类型为: image/jpeg
2025-07-06 18:58:41 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmperookn1y.jpeg
2025-07-06 18:58:44 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 18:58:44 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 81 字符。
2025-07-06 18:58:44 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=172 的状态为 2
2025-07-06 19:41:38 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=171 的状态为 1
2025-07-06 19:41:38 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp56gk0ky7.jpeg
2025-07-06 19:41:38 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp56gk0ky7.jpeg
2025-07-06 19:41:38 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp56gk0ky7.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-06 19:41:38 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp56gk0ky7.jpeg' 的MIME类型为: image/jpeg
2025-07-06 19:41:38 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp56gk0ky7.jpeg
2025-07-06 19:41:42 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 19:41:42 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 76 字符。
2025-07-06 19:41:42 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=171 的状态为 2
2025-07-06 19:50:12 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=162 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 162
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 162
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 162
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-06 19:50:12 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpqgeg1yh8.docx
2025-07-06 19:50:12 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpqgeg1yh8.docx
2025-07-06 19:50:12 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-06 19:50:12 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpqgeg1yh8.docx
2025-07-06 19:50:12 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-06 19:50:12 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 19:50:22 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=162 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 162
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 162
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    db_manager.execute_update(query)
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 162
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-06 19:50:23 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp0rjnteb_.docx
2025-07-06 19:50:23 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp0rjnteb_.docx
2025-07-06 19:50:23 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-06 19:50:23 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp0rjnteb_.docx
2025-07-06 19:50:23 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-06 19:50:23 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-06 19:50:30 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 19:50:30 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1380
2025-07-06 19:50:31 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-06 19:50:37 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-06 19:50:37 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 970
2025-07-06 19:50:38 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=162 的状态为 2
2025-07-07 09:17:54 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 1
2025-07-07 09:17:54 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmphfghtxwu.docx
2025-07-07 09:17:54 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmphfghtxwu.docx
2025-07-07 09:17:54 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-07 09:17:54 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmphfghtxwu.docx
2025-07-07 09:17:54 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-07 09:17:54 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 09:17:55 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=177 状态失败：更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 806, in _write_bytes
    self._sock.sendall(data)
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 09:17:55 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpwqthfazh.docx
2025-07-07 09:17:55 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpwqthfazh.docx
2025-07-07 09:17:55 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-07 09:17:55 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpwqthfazh.docx
2025-07-07 09:17:55 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-07 09:17:55 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 09:17:58 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 1
2025-07-07 09:17:58 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmp20bgl452.docx
2025-07-07 09:17:58 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmp20bgl452.docx
2025-07-07 09:17:58 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-07 09:17:58 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmp20bgl452.docx
2025-07-07 09:17:58 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-07 09:17:58 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 09:18:11 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 09:18:11 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1089
2025-07-07 09:18:12 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 2
2025-07-07 09:18:16 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 09:18:16 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1282
2025-07-07 09:18:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 2
2025-07-07 09:18:21 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 09:18:21 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1796
2025-07-07 09:18:21 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 2
2025-07-07 10:11:15 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=178 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 178
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 178
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 178
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 10:11:15 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpxg8k0dzl.jpeg
2025-07-07 10:11:15 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpxg8k0dzl.jpeg
2025-07-07 10:11:15 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpxg8k0dzl.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 10:11:15 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpxg8k0dzl.jpeg' 的MIME类型为: image/jpeg
2025-07-07 10:11:15 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpxg8k0dzl.jpeg
2025-07-07 10:11:19 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 10:11:19 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 68 字符。
2025-07-07 10:11:22 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=178 的状态为 2
2025-07-07 10:11:31 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=179 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 179
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 179
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 179
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 10:11:32 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpjeovyve1.jpeg
2025-07-07 10:11:32 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpjeovyve1.jpeg
2025-07-07 10:11:32 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpjeovyve1.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 10:11:32 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpjeovyve1.jpeg' 的MIME类型为: image/jpeg
2025-07-07 10:11:32 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpjeovyve1.jpeg
2025-07-07 10:11:35 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 10:11:35 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 68 字符。
2025-07-07 10:11:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=179 的状态为 2
2025-07-07 10:20:40 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 1
2025-07-07 10:20:40 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpqliw2alp.jpeg
2025-07-07 10:20:40 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpqliw2alp.jpeg
2025-07-07 10:20:40 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpqliw2alp.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 10:20:40 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpqliw2alp.jpeg' 的MIME类型为: image/jpeg
2025-07-07 10:20:40 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpqliw2alp.jpeg
2025-07-07 10:20:43 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 10:20:43 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 77 字符。
2025-07-07 10:20:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 1
2025-07-07 10:20:43 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-07 10:20:44 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpq875lp48.jpeg
2025-07-07 10:20:44 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpq875lp48.jpeg
2025-07-07 10:20:44 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpq875lp48.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 10:20:44 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpq875lp48.jpeg' 的MIME类型为: image/jpeg
2025-07-07 10:20:44 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpq875lp48.jpeg
2025-07-07 10:20:46 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 10:20:46 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 72 字符。
2025-07-07 10:20:46 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-07 10:20:55 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 1
2025-07-07 10:20:55 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpk18h5el5.docx
2025-07-07 10:20:55 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpk18h5el5.docx
2025-07-07 10:20:55 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 3 个原始段落。
2025-07-07 10:20:55 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpk18h5el5.docx
2025-07-07 10:20:55 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 201
2025-07-07 10:20:55 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 10:20:58 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 1
2025-07-07 10:20:58 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpp7h5g_1p.docx
2025-07-07 10:20:58 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpp7h5g_1p.docx
2025-07-07 10:20:58 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 3 个原始段落。
2025-07-07 10:20:58 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpp7h5g_1p.docx
2025-07-07 10:20:58 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 201
2025-07-07 10:20:58 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 10:21:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 10:21:07 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 572
2025-07-07 10:21:08 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 2
2025-07-07 10:21:09 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 10:21:09 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 620
2025-07-07 10:21:09 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=175 的状态为 2
2025-07-07 11:09:29 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 1
2025-07-07 11:09:30 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpzdba76q3.jpeg
2025-07-07 11:09:30 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpzdba76q3.jpeg
2025-07-07 11:09:30 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpzdba76q3.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 11:09:30 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpzdba76q3.jpeg' 的MIME类型为: image/jpeg
2025-07-07 11:09:30 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpzdba76q3.jpeg
2025-07-07 11:09:47 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 11:09:47 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 74 字符。
2025-07-07 11:09:47 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-07 11:10:08 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 1
2025-07-07 11:10:08 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 1
2025-07-07 11:10:08 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpewftiwca.jpeg
2025-07-07 11:10:08 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpewftiwca.jpeg
2025-07-07 11:10:08 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpewftiwca.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 11:10:08 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpewftiwca.jpeg' 的MIME类型为: image/jpeg
2025-07-07 11:10:08 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpewftiwca.jpeg
2025-07-07 11:10:08 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpuaolxbo9.jpeg
2025-07-07 11:10:08 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpuaolxbo9.jpeg
2025-07-07 11:10:08 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpuaolxbo9.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 11:10:08 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpuaolxbo9.jpeg' 的MIME类型为: image/jpeg
2025-07-07 11:10:08 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpuaolxbo9.jpeg
2025-07-07 11:10:16 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 11:10:16 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 71 字符。
2025-07-07 11:10:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-07 11:10:16 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 11:10:16 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 70 字符。
2025-07-07 11:10:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-07 11:14:28 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=160 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 160
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 160
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 160
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 11:14:28 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=160 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 160
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 160
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 160
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmp33sh_csp.xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmp33sh_csp.xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmp33sh_csp.xlsx
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:688 - 开始总结表格: /tmp/tmpwt_dii7b.xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:557 - 尝试读取表格源: /tmp/tmpwt_dii7b.xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:616 - 输入为本地文件路径: /tmp/tmpwt_dii7b.xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:618 - 本地文件格式: .xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmpwt_dii7b.xlsx
2025-07-07 11:14:28 - summarizer - INFO - read_table:622 - 成功读取本地 Excel 文件: /tmp/tmp33sh_csp.xlsx
2025-07-07 11:14:28 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-07 11:14:28 - summarizer - INFO - get_table_info:648 - 开始提取表格信息，行数: 3, 列数: 2
2025-07-07 11:14:28 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-07 11:14:28 - summarizer - INFO - get_table_info:660 - 找到数值列: []
2025-07-07 11:14:28 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-07 11:14:28 - summarizer - INFO - get_table_info:677 - 表格信息提取完成。
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:704 - 表格信息字符串长度: 185
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:705 - 数据示例字符串长度: 147
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-07 11:14:28 - summarizer - INFO - summarize_table:738 - 向 LLM 发送请求进行表格总结...
2025-07-07 11:14:32 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 11:14:32 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 95
2025-07-07 11:14:32 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-07 11:14:32 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 11:14:32 - summarizer - INFO - summarize_table:749 - LLM 表格总结接收成功，长度: 113
2025-07-07 11:14:32 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=160 的状态为 2
2025-07-07 11:25:33 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=161 状态失败：更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 161
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 782, in _read_bytes
    data = self._rfile.read(num_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/socket.py", line 720, in readinto
    return self._sock.recv_into(b)
           ^^^^^^^^^^^^^^^^^^^^^^^
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 744, in _read_packet
    packet_header = self._read_bytes(4)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 788, in _read_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 161
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query ([Errno 110] Connection timed out)')
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 161
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 11:25:34 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp9lka842g.jpeg
2025-07-07 11:25:34 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp9lka842g.jpeg
2025-07-07 11:25:34 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp9lka842g.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 11:25:34 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp9lka842g.jpeg' 的MIME类型为: image/jpeg
2025-07-07 11:25:34 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp9lka842g.jpeg
2025-07-07 11:25:37 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 11:25:37 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 72 字符。
2025-07-07 11:25:37 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=161 的状态为 2
2025-07-07 15:52:02 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=177 状态失败：更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 806, in _write_bytes
    self._sock.sendall(data)
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 1,
        ai_text = '处理中...',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 177
        AND tenant_id = 30
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 15:52:02 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpkmrlj35x.docx
2025-07-07 15:52:02 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpkmrlj35x.docx
2025-07-07 15:52:02 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-07 15:52:02 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpkmrlj35x.docx
2025-07-07 15:52:02 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-07 15:52:02 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 15:52:26 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 15:52:26 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1203
2025-07-07 15:52:26 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=177 的状态为 2
2025-07-07 21:01:16 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=180 的状态为 1
2025-07-07 21:01:17 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpe26nnqp7.jpeg
2025-07-07 21:01:17 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpe26nnqp7.jpeg
2025-07-07 21:01:17 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpe26nnqp7.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 21:01:17 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpe26nnqp7.jpeg' 的MIME类型为: image/jpeg
2025-07-07 21:01:17 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpe26nnqp7.jpeg
2025-07-07 21:01:20 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 21:01:20 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 69 字符。
2025-07-07 21:01:20 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=180 的状态为 2
2025-07-07 22:01:02 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=181 的状态为 1
2025-07-07 22:01:02 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmp0aj9gwed.jpeg
2025-07-07 22:01:02 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmp0aj9gwed.jpeg
2025-07-07 22:01:02 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmp0aj9gwed.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 22:01:02 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmp0aj9gwed.jpeg' 的MIME类型为: image/jpeg
2025-07-07 22:01:02 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmp0aj9gwed.jpeg
2025-07-07 22:01:07 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 22:01:07 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 67 字符。
2025-07-07 22:01:07 - database - ERROR - update_sale_ai_data_status:86 - 更新 AI 数据记录 ID=181 状态失败：更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '这张图片展示了一片现代化城市景观。画面中，几栋高耸的玻璃幕墙写字楼矗立，反射着蓝天。楼下绿植环绕，道路整洁，整体给人以清新、繁荣之感。',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 181
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 806, in _write_bytes
    self._sock.sendall(data)
TimeoutError: [Errno 110] Connection timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 139, in execute_update
    result = connection.execute(text(query))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 562, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 864, in _execute_command
    self._write_bytes(packet)
  File "/home/funhpc/miniconda3/envs/adk/lib/python3.12/site-packages/pymysql/connections.py", line 809, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '这张图片展示了一片现代化城市景观。画面中，几栋高耸的玻璃幕墙写字楼矗立，反射着蓝天。楼下绿植环绕，道路整洁，整体给人以清新、繁荣之感。',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 181
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/funhpc/workspace/aisell_dev/utils/db_insert.py", line 82, in update_sale_ai_data_status
    logger.info(f"成功插入 AI 数据记录：tenant_id={tenant_id}, type={ai_type}, status={ai_status}")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/funhpc/workspace/aisell_dev/tools/database.py", line 143, in execute_update
    except Exception as e:
        ^^^^^^^^^^^^^^^^^^^
Exception: 更新数据失败: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (TimeoutError(110, 'Connection timed out'))")
[SQL: 
    UPDATE sale_ai_data
    SET
        ai_status = 2,
        ai_text = '这张图片展示了一片现代化城市景观。画面中，几栋高耸的玻璃幕墙写字楼矗立，反射着蓝天。楼下绿植环绕，道路整洁，整体给人以清新、繁荣之感。',
        update_time = CURRENT_TIMESTAMP
    WHERE
        id = 181
        AND tenant_id = 1
        AND is_del = 0; -- 仅更新未被逻辑删除的记录
    ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-07 22:01:27 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=182 的状态为 1
2025-07-07 22:01:27 - summarizer - INFO - summarize_document:1583 - 开始总结文档: /tmp/tmpdgvoee_5.docx
2025-07-07 22:01:27 - summarizer - INFO - extract_docx_content:1451 - 开始提取DOCX内容: /tmp/tmpdgvoee_5.docx
2025-07-07 22:01:27 - summarizer - INFO - extract_docx_content:1478 - DOCX共有 85 个原始段落。
2025-07-07 22:01:27 - summarizer - INFO - extract_docx_content:1511 - DOCX内容提取完成: /tmp/tmpdgvoee_5.docx
2025-07-07 22:01:27 - summarizer - INFO - summarize_document:1609 - 提取的文档内容序列化后字符串长度: 3714
2025-07-07 22:01:27 - summarizer - INFO - summarize_document:1646 - 向 LLM (ernie-4.5-turbo-128k) 发送请求进行文档总结...
2025-07-07 22:01:49 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 22:01:49 - summarizer - INFO - summarize_document:1667 - LLM 文档总结接收成功，长度: 1555
2025-07-07 22:01:49 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=182 的状态为 2
2025-07-07 22:11:30 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=183 的状态为 1
2025-07-07 22:11:30 - summarizer - INFO - summarize_single_image:370 - 开始处理单张图片总结: /tmp/tmpcokkyj_d.jpeg
2025-07-07 22:11:30 - summarizer - INFO - get_image_url_dict:343 - 输入为本地文件路径，将进行Base64编码: /tmp/tmpcokkyj_d.jpeg
2025-07-07 22:11:30 - summarizer - INFO - encode_image:321 - 图片 '/tmp/tmpcokkyj_d.jpeg' Base64编码成功。编码后数据长度(部分): 100...
2025-07-07 22:11:30 - summarizer - INFO - get_image_url_dict:358 - 推断出图片 '/tmp/tmpcokkyj_d.jpeg' 的MIME类型为: image/jpeg
2025-07-07 22:11:30 - summarizer - INFO - summarize_single_image:385 - 向模型 'ernie-4.5-turbo-vl-preview' 发送单图总结请求。图片来源: /tmp/tmpcokkyj_d.jpeg
2025-07-07 22:11:34 - httpx - INFO - _send_single_request:1025 - HTTP Request: POST https://qianfan.baidubce.com/v2/chat/completions "HTTP/1.1 200 OK"
2025-07-07 22:11:34 - summarizer - INFO - summarize_single_image:408 - 成功从模型获取单图总结。总结长度: 73 字符。
2025-07-07 22:11:35 - database - INFO - update_sale_ai_data_status:83 - 成功更新 AI 数据记录 ID=183 的状态为 2
